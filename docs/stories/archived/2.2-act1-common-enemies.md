# Story 2.2: Act 1 Common Enemies

## Status: Done

## Story

**As a** player exploring Act 1,
**I want** varied common enemies with distinct behaviors,
**so that** combat feels fresh and requires different strategies.

---

## Narrative Context: The Entrance Halls

> *"The Entrance Halls echo with the recently consumed. They came seeking glory, treasure, answers. Now they seek nothing—but their bodies remember violence."*

### Act 1 Theme: Memory and Loss

The enemies of Act 1 are **the Forgotten**—souls who entered the Sanctum and failed. Unlike deeper enemies who have been twisted beyond recognition, these still carry echoes of who they were. Some remember fragments. Most remember nothing except the motion of combat.

Fighting them should feel melancholy, not triumphant. Every skeleton was someone's child. Every zombie carried hopes. The flavor text and death quotes remind players that these were people once.

### The Narrative Purpose of Common Enemies

Act 1 enemies teach players:
1. **Basic mechanics** (block, damage, status effects)
2. **The world's truth** (everyone here was someone once)
3. **Mercy** (defeating them is release, not murder)

---

## Acceptance Criteria

1. Act 1 has 8 common enemy types total (3 exist: Cultist, Skeleton, Zombie)
2. Each enemy has unique HP, moves, and weighted AI patterns
3. Enemies telegraph their intents clearly
4. New enemies fit the "Entrance Halls" theme (Undead/Cultists)
5. Enemy difficulty scales appropriately for Act 1 (early game)
6. Combat can spawn 1-3 enemies per encounter
7. **NEW: Each enemy has backstory flavor text and death quote**
8. **NEW: Encounter groups feel like "parties" that entered together**

## Tasks / Subtasks

- [x] Design 5 new Act 1 common enemies (AC: 1, 4, 5)
  - [x] **Haunted Armor** (35 HP) - Defensive enemy
    - Shield Bash (Attack 5, 50%)
    - Fortify (Block 10, 30%)
    - Heavy Swing (Attack 8, 20%)
  - [x] **Acolyte** (25 HP) - Support/buffer enemy
    - Dark Prayer (Buff ally +2 Might, 40%)
    - Shadow Bolt (Attack 4, 40%)
    - Sacrifice (Heal ally 8, lose 5 HP, 20%)
  - [x] **Ghoul** (38 HP) - Aggressive enemy
    - Claw (Attack 7, 45%)
    - Frenzy (Attack 4 twice, 35%)
    - Devour (Attack 5, Heal 5, 20%)
  - [x] **Bone Archer** (22 HP) - Glass cannon
    - Arrow Shot (Attack 9, 60%)
    - Poison Arrow (Attack 5, Apply 3 Bleeding, 25%)
    - Retreat (Block 4, 15%)
  - [x] **Shade** (28 HP) - Debuffer enemy
    - Life Drain (Attack 4, Heal 4, 35%)
    - Curse (Apply Impaired 2 turns, 35%)
    - Phase (Become untargetable 1 turn, 30%)

- [x] Implement enemy definitions (AC: 2, 3)
  - [x] Add all 5 enemies to `src/data/enemies/act1.ts`
  - [x] Define moves with proper intent types
  - [x] Set appropriate weights for move selection

- [x] Implement new enemy mechanics (AC: 2)
  - [x] Multi-attack intent (Frenzy: attack X times)
  - [x] Heal intent (self-healing enemies)
  - [x] Buff ally intent (Acolyte buffing other enemies)
  - [x] Apply debuff intent (Shade applying Impaired)
  - [x] Untargetable status (Shade's Phase)

- [x] Update CombatEngine for new mechanics
  - [x] Handle MULTI_ATTACK intent type
  - [x] Handle BUFF_ALLY intent type
  - [x] Handle DEBUFF_PLAYER intent type
  - [x] Handle HEAL_SELF intent type
  - [x] Handle untargetable enemies (skip targeting, show UI indicator)

- [ ] Update UI for new intent types (AC: 3) - Deferred to UI Epic
  - [ ] Multi-attack icon
  - [ ] Buff icon
  - [ ] Debuff icon
  - [ ] Heal icon
  - [ ] Untargetable visual state

- [x] Create encounter configurations - Documented in story, code deferred to map system
  - [x] Define which enemies can appear together
  - [x] Define encounter difficulty tiers
  - [x] Balance HP totals per encounter (target: 40-80 HP total for Act 1)

- [x] Write unit tests
  - [x] Test each enemy has correct HP and moves
  - [x] Test multi-attack deals damage multiple times
  - [x] Test buff ally increases target's Might
  - [x] Test debuff applies status to player
  - [x] Test heal restores enemy HP
  - [x] Test untargetable enemies can't be targeted

## Dev Notes

### Enemy Design Philosophy (Act 1)

Act 1 enemies should:
- Teach basic mechanics (block, damage, status effects)
- Be forgiving but not trivial
- Introduce one mechanic per enemy type
- Scale from 22 HP (Bone Archer) to 55 HP (Zombie)
- **Feel like tragedies, not targets**

---

## Enemy Roster: The Forgotten (Narrative Details)

### 1. Forgotten Pilgrim (Skeleton)
**HP:** 30 | **Role:** Glass Cannon

**Who They Were:** Adventurers who came seeking glory. Their armor rotted away but their bones remember how to fight. Some still clutch rusted swords. Some wear the remains of tabards from kingdoms that no longer exist.

**Death Quote:** *"I wrote letters home... who were they to?"*

**Visual Notes:** Posture suggests confusion. Eyes (empty sockets) track the player with something like recognition.

---

### 2. Consumed Delver (Zombie)
**HP:** 55 | **Role:** Tank

**Who They Were:** Healers, porters, guides—the support roles who followed adventuring parties into the Sanctum. They often died trying to save others. Some still clutch healer's kits that don't work anymore.

**Death Quote:** *"I had medicine... it wasn't enough..."*

**Visual Notes:** Often wearing torn healer's robes. Some have hands frozen in gestures of healing.

**Drop Bonus:** 10% chance to drop a potion (they brought supplies)

---

### 3. Hollow Initiate (Cultist)
**HP:** 42 | **Role:** Balanced

**Who They Were:** True believers who came seeking the Hollow God willingly. Unlike others, they weren't tricked or desperate—they wanted emptiness. They found it.

**Death Quote:** *"The void promised understanding... I understand now..."*

**Visual Notes:** Empty expressions. Move with eerie calm. Robes are pristine—the void preserves its servants.

---

### 4. Oathbroken (Haunted Armor)
**HP:** 35 | **Role:** Defensive

**Who They Were:** Knights of the Drowned King's guard who failed to protect their liege. When the King fell, they fell with him. Their armor walks on without them—animated by duty even death couldn't end.

**Death Quote:** *"My liege... I'm sorry I failed you..."*

**Visual Notes:** The armor moves like a puppet—no one inside. The crest on the shield matches the Drowned King's banners.

**Special Interaction:** If the player is the Dungeon Knight, Oathbroken enemies deal +2 damage and have unique dialogue: *"You... you look like one of us... traitor..."*

---

### 5. Ghoul
**HP:** 38 | **Role:** Aggressive

**Who They Were:** Survivors who did what they had to do when the food ran out. They ate the fallen. Then they ate those who weren't quite fallen yet. The Sanctum rewards hunger—it made them very hungry indeed.

**Death Quote:** *[No words—just a sigh of relief. They've forgotten speech.]*

**Visual Notes:** Hunched, feral posture. Hands are more claw than finger. Eyes are hungry but also... tired.

---

### 6. Bone Archer
**HP:** 22 | **Role:** Glass Cannon

**Who They Were:** Scouts who went ahead of their parties. They signaled warnings that never saved anyone. Some died pointing toward danger, and their bones kept pointing.

**Death Quote:** *"I signaled them to run... did they make it?"*

**Visual Notes:** One arm perpetually raised, pointing. Arrows in the quiver are mostly gone—they've been firing for years.

---

### 7. Shade
**HP:** 28 | **Role:** Debuffer

**Who They Were:** Mages who tried to understand the Hollow God through study. They reached out with their minds and something reached back. Now they exist between states—not quite consumed, not quite present.

**Death Quote:** *"I saw what's behind reality. I wish I hadn't."*

**Visual Notes:** Translucent. Features blur and shift. Sometimes you see another face beneath theirs—the person they used to be.

---

### 8. Acolyte
**HP:** 25 | **Role:** Support

**Who They Were:** Students of the Hollow Initiates. Less committed, more coerced. They serve the cult because they couldn't escape it. Some still hope for rescue.

**Death Quote:** *"I didn't want this... thank you..."*

**Visual Notes:** Younger than other enemies. Robes don't quite fit—hand-me-downs. Eyes show fear, not emptiness.

---

## Encounter Design: They Fight Together

Enemies should appear in combinations that feel like *parties*—groups that entered together and fell together.

### Easy Encounters (40-50 HP total)
| Enemies | Flavor |
|---------|--------|
| Solo Forgotten Pilgrim | *"A lone adventurer. They were always alone."* |
| Hollow Initiate + Acolyte | *"Master and student. The student prays for both."* |

### Medium Encounters (50-70 HP total)
| Enemies | Flavor |
|---------|--------|
| Consumed Delver + Forgotten Pilgrim | *"The healer couldn't save the warrior."* |
| Oathbroken + Oathbroken | *"They held the line together. They hold it still."* |
| Hollow Initiate + Shade | *"The priest and the scholar. Both sought truth."* |

### Hard Encounters (70-90 HP total)
| Enemies | Flavor |
|---------|--------|
| Ghoul + Bone Archer + Acolyte | *"A hunting party. The ghoul ate the others."* |
| Shade + Hollow Initiate + Acolyte | *"A cult congregation. They pray to emptiness."* |
| Consumed Delver + Forgotten Pilgrim + Bone Archer | *"An adventuring party. They almost made it."* |

---

### New Intent Types Needed

```typescript
enum IntentType {
  ATTACK = 'attack',
  DEFEND = 'defend',
  BUFF = 'buff',           // Buff self
  BUFF_ALLY = 'buff_ally', // Buff another enemy
  DEBUFF = 'debuff',       // Debuff player
  HEAL = 'heal',           // Heal self
  MULTI_ATTACK = 'multi_attack', // Attack multiple times
  UNKNOWN = 'unknown',
}
```

### Enemy Definitions

```typescript
// Example: Ghoul
const GHOUL: EnemyDefinition = {
  id: 'ghoul',
  name: 'Ghoul',
  maxHp: 38,
  moves: [
    { id: 'claw', name: 'Claw', intent: IntentType.ATTACK, damage: 7, weight: 45 },
    { id: 'frenzy', name: 'Frenzy', intent: IntentType.MULTI_ATTACK, damage: 4, times: 2, weight: 35 },
    { id: 'devour', name: 'Devour', intent: IntentType.ATTACK, damage: 5, heal: 5, weight: 20 },
  ],
};
```

### Encounter Examples

```typescript
// Easy encounter
{ enemies: ['skeleton'] }

// Medium encounter
{ enemies: ['cultist', 'acolyte'] }

// Hard encounter
{ enemies: ['ghoul', 'bone_archer', 'shade'] }
```

### Balance Targets

| Enemy | HP | Avg Damage/Turn | Role |
|-------|-----|-----------------|------|
| Skeleton | 30 | 6.5 | Glass cannon |
| Cultist | 42 | 7.0 | Balanced |
| Zombie | 55 | 7.2 | Tank |
| Haunted Armor | 35 | 5.5 | Defensive |
| Acolyte | 25 | 2.0 | Support |
| Ghoul | 38 | 6.8 | Aggressive |
| Bone Archer | 22 | 7.5 | Glass cannon |
| Shade | 28 | 4.0 | Debuffer |

## Testing

### Test File Location
`src/tests/enemies/Act1Enemies.test.ts`

### Key Test Scenarios

1. **Enemy Stats**: Each enemy has correct HP
2. **Move Weights**: Moves selected according to weights
3. **Multi-Attack**: Frenzy deals damage twice
4. **Buff Ally**: Acolyte's Dark Prayer increases ally Might
5. **Debuff**: Shade's Curse applies Impaired to player
6. **Self-Heal**: Ghoul's Devour and Life Drain restore HP
7. **Untargetable**: Shade in Phase state cannot be targeted

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- No significant issues encountered during implementation

### Completion Notes List
- Added 5 new Act 1 common enemies: Haunted Armor, Acolyte, Ghoul, Bone Archer, Shade
- Implemented new IntentTypes: MULTI_ATTACK, BUFF_ALLY, DEBUFF, HEAL
- Extended EnemyMove and EnemyIntent interfaces with new properties (times, heal, selfDamage, buffType, buffAmount, debuffType, debuffDuration)
- Added `might` and `untargetable` properties to Enemy interface
- Updated CombatEngine endTurn to handle all new intent types
- Implemented Might bonus damage system for buff_ally mechanic
- Implemented untargetable mechanic with reset at start of enemy turn
- 21 new tests covering all enemy mechanics
- Total: 114 tests passing
- UI icons deferred to UI Epic

### File List
- `src/types/index.ts` (modified) - Added new IntentTypes, extended EnemyMove/EnemyIntent/Enemy interfaces
- `src/data/enemies/act1.ts` (modified) - Added 5 new enemy definitions
- `src/engine/CombatEngine.ts` (modified) - Enemy initialization with might/untargetable, new intent handling
- `src/data/enemies/act1.test.ts` (created) - 21 tests for Act 1 enemies

---

## QA Results
_To be filled by QA agent_
