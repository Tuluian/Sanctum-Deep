# Story 2.6: Dungeon Knight Card Pool

## Status: Complete

## Story

**As a** Dungeon Knight player,
**I want** a full pool of cards to discover during my run,
**so that** I can build diverse decks around Fortify and defensive strategies.

---

## Card Flavor Guide: The Knight's Voice

> *"The Order taught us to hold the line. They didn't mention we'd become it."*

### Flavor Philosophy
Knight cards should feel like:
- Military techniques with history
- Personal mantras forged in duty
- Echoes of the mentor Ser Aldric

### Card Names: From Generic to Evocative

| Generic Name | Evocative Alternative | Flavor Text |
|--------------|----------------------|-------------|
| Quick Strike | Swift Discipline | *"First lesson: Strike before doubt."* |
| Heavy Blow | Verdict | *"The Order doesn't ask twice."* |
| Iron Skin | Ser Aldric's Stance | *"My mentor held this position for three days. I will hold it forever."* |
| Defensive Stance | Sealed Gate Guard | *"The gate doesn't move. Neither do I."* |
| Riposte | Lesson Remembered | *"You taught me this move, mentor. Now I teach it back."* |
| Shield Bash | Weight of Duty | *"This shield carried the crest of a knight who never returned. I will return."* |
| Cleave | Arc of the Fallen | *"One swing for each knight who came before me."* |
| Executioner | Mercy's Edge | *"Some wounds cannot be healed. This is how we help."* |
| Unbreakable | The Line Holds | *"I am the wall. I am the gate. I am the Order."* |
| Counter Strike | Aldric's Answer | *"My mentor always said: 'Let them come to you. Then show them why they shouldn't have.'"* |
| Fortress | Final Stand | *"This is where I stop. This is where everything stops."* |

### Starter Deck Flavor

**Sword Strike → Disciplined Cut**
*"First form. Basic. Essential. The foundation of everything that follows."*

**Raise Shield → Hold the Line**
*"The Order's motto. The first words a knight learns. The last words many whisper."*

**Bulwark Stance → Ser Aldric's Teaching**
*"'Patience,' he said. 'Let them wear themselves against you. Then strike.'"*

---

## Acceptance Criteria

1. Dungeon Knight has 30 total cards (4 starter + 26 obtainable)
2. Cards distributed by rarity: 15 Common, 8 Uncommon, 3 Rare
3. Cards support multiple archetypes: Fortify, Offense, Counter-Attack
4. Fortify synergies are meaningful (damage based on Fortify, etc.)
5. All cards have clear descriptions and balanced stats
6. Cards appear in post-combat rewards based on rarity weights

## Tasks / Subtasks

- [ ] Design Common Knight cards (15 cards)
  - [ ] **Quick Strike** (1 Resolve): Deal 4 damage. Draw 1 card
  - [ ] **Fortified Guard** (1 Resolve): Gain 4 block. Convert to Fortify
  - [ ] **Heavy Blow** (2 Resolve): Deal 10 damage
  - [ ] **Iron Skin** (1 Resolve): Gain 3 Fortify
  - [ ] **Defensive Stance** (1 Resolve): Gain 8 block
  - [ ] **Riposte** (1 Resolve): Gain 4 block. If attacked this turn, deal 6 damage
  - [ ] **Armor Up** (0 Resolve): Gain 3 block
  - [ ] **Battering Ram** (2 Resolve): Deal 8 damage. If enemy has block, deal 4 more
  - [ ] **Shield Bash** (1 Resolve): Deal damage equal to your Block
  - [ ] **Stalwart** (1 Resolve): Gain 5 block. Gain 2 Fortify
  - [ ] **Cleave** (1 Resolve): Deal 5 damage to all enemies
  - [ ] **Second Wind** (1 Resolve): Gain block equal to your Fortify
  - [ ] **Press the Attack** (1 Resolve): Deal 6 damage. If enemy HP < 50%, deal 3 more
  - [ ] **Hold the Line** (1 Resolve): Gain 6 block. Next turn, gain 3 block
  - [ ] **Vengeful Strike** (1 Resolve): Deal 3 damage. Deal +1 for each time you were attacked this combat

- [ ] Design Uncommon Knight cards (8 cards)
  - [ ] **Shieldbash** (2 Resolve): Deal damage equal to your Fortify twice
  - [ ] **Iron Resolve** (1 Resolve, Power): Fortify cap increased by 10
  - [ ] **Defensive Formation** (2 Resolve): Gain 12 block. Next turn, gain 6 block
  - [ ] **Sentinel's Watch** (2 Resolve, Power): Gain 3 block at start of each turn
  - [ ] **Crushing Counter** (2 Resolve): Gain 8 block. When attacked, deal 12 damage
  - [ ] **Wall of Steel** (2 Resolve): Gain 15 block. Cannot attack this turn
  - [ ] **Fortify Mastery** (1 Resolve): Double your current Fortify
  - [ ] **Executioner** (2 Resolve): Deal 15 damage. If this kills, gain 5 Fortify

- [ ] Design Rare Knight cards (3 cards)
  - [ ] **Unbreakable** (2 Resolve, Power): Block doesn't reset at end of turn
  - [ ] **Counter Strike** (1 Resolve): Gain 10 block. Whenever you're attacked this turn, deal 8 damage
  - [ ] **Fortress** (3 Resolve, Exhaust): Gain Fortify equal to your max HP / 5. Gain 20 block

- [ ] Implement all card definitions
  - [ ] Add cards to `src/data/cards/knight.ts`
  - [ ] Include rarity field on CardDefinition

- [ ] Implement new effect types for Knight
  - [ ] CONVERT_BLOCK_TO_FORTIFY: Convert current block to Fortify
  - [ ] DAMAGE_EQUAL_TO_BLOCK: Deal damage equal to Block
  - [ ] DAMAGE_EQUAL_TO_FORTIFY: Deal damage equal to Fortify
  - [ ] GAIN_BLOCK_EQUAL_TO_FORTIFY: Gain block equal to Fortify
  - [ ] INCREASE_FORTIFY_CAP: Raise maxFortify
  - [ ] DOUBLE_FORTIFY: Double current Fortify amount
  - [ ] ON_ATTACKED_EFFECT: Trigger effect when attacked
  - [ ] CONDITIONAL_ENEMY_HP: Extra effect if enemy HP below threshold
  - [ ] BLOCK_NEXT_TURN: Gain X block at start of next turn

- [ ] Implement "When Attacked" trigger system
  - [ ] Track cards with on-attacked effects
  - [ ] Trigger effects when enemy attacks player
  - [ ] Handle multiple on-attacked effects

- [ ] Implement Unbreakable Power
  - [ ] Block no longer resets at end of turn
  - [ ] Still uses block to absorb damage normally
  - [ ] Visual indicator for Unbreakable status

- [ ] Write unit tests
  - [ ] Test Fortify conversion from block
  - [ ] Test damage equal to Fortify/Block
  - [ ] Test Fortify cap increase
  - [ ] Test on-attacked triggers (Riposte, Counter Strike)
  - [ ] Test Unbreakable block persistence
  - [ ] Test Fortify doubling

## Dev Notes

### Fortify Synergies

The Knight's identity revolves around Fortify:

1. **Building Fortify**: Iron Skin, Fortified Guard, Stalwart
2. **Using Fortify**: Shieldbash (damage), Second Wind (block)
3. **Scaling Fortify**: Iron Resolve (cap), Fortify Mastery (double)
4. **Fortify Payoff**: High Fortify = free damage/block each turn

### On-Attacked Trigger System

```typescript
interface OnAttackedEffect {
  type: 'ON_ATTACKED';
  effects: CardEffect[];
  duration: 'this_turn' | 'this_combat' | 'permanent';
}

// Track active on-attacked effects
interface CombatState {
  // ... existing
  onAttackedEffects: OnAttackedEffect[];
}

// Trigger when enemy attacks
function handleEnemyAttack(damage: number): void {
  // Apply damage first
  dealDamageToPlayer(damage);

  // Then trigger on-attacked effects
  for (const effect of state.onAttackedEffects) {
    executeEffects(effect.effects);
  }

  // Clean up this-turn effects
  state.onAttackedEffects = state.onAttackedEffects.filter(
    e => e.duration !== 'this_turn'
  );
}
```

### Unbreakable Implementation

```typescript
// In PlayerState
interface PlayerState {
  // ... existing
  unbreakable: boolean; // Block doesn't reset
}

// In endTurn
function endTurn(): void {
  // ... enemy actions

  // Reset block (unless Unbreakable)
  if (!state.player.unbreakable) {
    state.player.block = 0;
  }

  // Fortify never resets (already implemented)
}
```

### Archetype Support

**Fortify Tank Build**:
- Iron Skin, Fortified Guard, Iron Resolve, Fortress
- Max out Fortify cap, become nearly invincible

**Counter-Attack Build**:
- Riposte, Counter Strike, Crushing Counter, Vengeful Strike
- Punish enemies for attacking you

**Balanced Offense Build**:
- Quick Strike, Heavy Blow, Cleave, Executioner
- Kill enemies before they can hurt you

### Balance Guidelines

Knight tends toward slower, grindier games. Cards should:
- Reward building up defenses
- Provide payoffs for high Fortify
- Include some offensive options to close out fights

| Card Type | Typical Values |
|-----------|---------------|
| Block gain | 4-15 |
| Fortify gain | 2-5 |
| Attack damage | 4-15 |
| Fortify-based damage | Fortify × 1-2 |

## Testing

### Test File Location
`src/tests/cards/KnightCards.test.ts`

### Key Test Scenarios

1. **Fortify Conversion**: Fortified Guard converts block to Fortify
2. **Fortify Damage**: Shieldbash deals damage = Fortify × 2
3. **Cap Increase**: Iron Resolve raises cap from 15 to 25
4. **On-Attacked**: Riposte triggers when attacked
5. **Unbreakable**: Block persists after end turn
6. **Double Fortify**: Fortify Mastery doubles 8 → 16
7. **Block-Based Damage**: Shield Bash deals damage = current Block

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
