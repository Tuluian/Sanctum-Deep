# Story 13.2: iOS UI Adaptations

## Status: Done

## Story

**As a** mobile player,
**I want** the game UI optimized for touch and iOS screen sizes,
**so that** gameplay feels native and comfortable on iPhone/iPad.

## Acceptance Criteria

1. Safe area insets respected (notch, home indicator)
2. Touch targets meet iOS HIG (44pt minimum)
3. Cards are easily tappable and draggable on touch
4. UI scales properly on iPhone SE through iPad Pro
5. Landscape orientation locked (or both orientations supported gracefully)
6. No text/elements cut off on any supported screen size
7. Haptic feedback on card plays and important actions
8. Keyboard doesn't obscure content (if text input exists)

## Tasks / Subtasks

- [x] Install Capacitor plugins (AC: 7)
  - [x] `npm install @capacitor/haptics`
  - [x] `npm install @capacitor/status-bar`
  - [ ] `npm install @capacitor/keyboard` (if needed - skipped, no text input)
- [x] Implement safe area handling (AC: 1)
  - [x] Use CSS `env(safe-area-inset-*)` variables
  - [x] Test on notched devices (iPhone X+)
  - [x] Ensure game content not obscured
- [x] Touch optimization (AC: 2, 3)
  - [x] Increase card hit areas for touch
  - [x] Add touch feedback states (pressed/released)
  - [x] Test card dragging on touch
  - [x] Ensure buttons meet 44pt minimum
- [x] Responsive scaling (AC: 4, 6)
  - [x] Test on iPhone SE (smallest)
  - [x] Test on iPhone 15 Pro Max (largest phone)
  - [x] Test on iPad (different aspect ratio)
  - [x] Fix any text/element overflow issues
- [x] Orientation handling (AC: 5)
  - [x] Decide: both orientations supported via responsive CSS
  - [x] Handle orientation changes gracefully
- [x] Haptic integration (AC: 7)
  - [x] Haptic on card play
  - [x] Haptic on damage dealt/received
  - [x] Haptic on turn change
  - [x] Haptic on victory/defeat
- [x] Status bar configuration
  - [x] Set status bar style (dark/light icons)
  - [x] Background color matches game theme

## Dev Notes

### Safe Area CSS

```css
.game-container {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}
```

### Haptics Implementation

```typescript
import { Haptics, ImpactStyle } from '@capacitor/haptics';

// Light tap for card selection
await Haptics.impact({ style: ImpactStyle.Light });

// Medium for card play
await Haptics.impact({ style: ImpactStyle.Medium });

// Heavy for damage/important events
await Haptics.impact({ style: ImpactStyle.Heavy });

// Notification for victory/defeat
await Haptics.notification({ type: 'success' });
await Haptics.notification({ type: 'error' });
```

### Touch Target Guidelines
- Minimum tap target: 44x44 points (Apple HIG)
- Cards should have generous tap areas
- Space between interactive elements: 8pt minimum
- Consider "fat finger" problem with small targets

### Screen Size Reference
| Device | Width | Height | Aspect |
|--------|-------|--------|--------|
| iPhone SE | 375pt | 667pt | 16:9 |
| iPhone 15 | 393pt | 852pt | 19.5:9 |
| iPhone 15 Pro Max | 430pt | 932pt | 19.5:9 |
| iPad 10th Gen | 820pt | 1180pt | 4:3 |
| iPad Pro 12.9" | 1024pt | 1366pt | 4:3 |

### Relevant Files
- `src/styles/main.css` - add safe area and responsive rules
- `src/ui/renderer.ts` - touch event handling
- `src/services/HapticsService.ts` (new) - haptic wrapper

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-04 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

**Dev Agent**: James (AI)
**Date**: 2025-12-06

### Implementation Summary

1. **Installed Capacitor Plugins**:
   - @capacitor/haptics@7.0.2
   - @capacitor/status-bar@7.0.3

2. **Safe Area Handling** (`src/styles/main.css`):
   - Added `env(safe-area-inset-*)` padding to body
   - Game content respects notch and home indicator
   - Prevents pull-to-refresh with `overscroll-behavior: none`

3. **Touch Optimization**:
   - Cards: 44pt minimum height, touch-action: manipulation
   - Buttons: 44pt minimum height
   - Added `:active` states for touch feedback
   - Media query for touch devices to disable hover effects

4. **HapticsService** (`src/services/HapticsService.ts`):
   - Wrapper for Capacitor Haptics with graceful fallback
   - Game-specific methods: cardPlayed, damageDealt, damageReceived, turnChange, victory, defeat
   - Integrated into main.ts combat events

5. **StatusBarService** (`src/services/StatusBarService.ts`):
   - Dark style (light icons) for game's dark theme
   - Background color #1a1a2e matches game
   - Initialized on DOMContentLoaded

### Files Modified
- `src/styles/main.css` - Safe areas, touch targets
- `src/main.ts` - Haptics integration, status bar init
- `src/services/HapticsService.ts` (new)
- `src/services/StatusBarService.ts` (new)

### Notes
- Keyboard plugin not needed (no text input in game)
- Both portrait and landscape work via responsive CSS

---

## QA Results

_To be filled by QA agent_
