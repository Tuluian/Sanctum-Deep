# Story 7.5: Onboarding & Contextual Tutorials

## Status: Draft

## Story

**As a** new player,
**I want** to learn the game naturally through guided play,
**so that** I can enjoy the game without reading walls of text or feeling lost.

## Problem Statement

Deck-builders have significant mechanical complexity. New players face information overload: card types, costs, resolve, block, status effects, class mechanics, map navigation, and more. Poor onboarding leads to confusion, frustration, and player drop-off.

## Acceptance Criteria

1. First run has optional interactive tutorial
2. Mechanics are introduced progressively
3. Tooltips explain all game terms on hover
4. Class-specific mechanics have dedicated explanation
5. "What does this do?" help is always available
6. Tutorial can be skipped by experienced players
7. Contextual hints appear when player seems stuck
8. Help/glossary accessible from pause menu

## UX Research: Onboarding Principles

### "Show, Don't Tell"

- Teach through doing, not reading
- One concept at a time
- Let player succeed, then build on success
- Avoid text dumps

### Progressive Disclosure

| Combat # | New Concepts Introduced |
|----------|------------------------|
| 1 | Playing cards, dealing damage |
| 2 | Block and defending |
| 3 | Status effects |
| 4 | Card draw mechanics |
| 5+ | No guidance (player is ready) |

### Respectful Tutorial Design

- Skippable at any point
- Never blocks actual gameplay
- Doesn't repeat information
- Remembers what player has learned

## Tasks / Subtasks

### First Run Tutorial Mode (AC: 1)

- [ ] Tutorial opt-in at game start
  - [ ] "First time playing?" prompt
  - [ ] Two options: "Guide me" / "I know deck-builders"
  - [ ] Choice saved, never asked again
- [ ] Simplified first encounter
  - [ ] Single weak enemy (10 HP)
  - [ ] Limited hand (3 cards)
  - [ ] Clear objectives
- [ ] Tutorial overlay system
  - [ ] Spotlight mechanic (dims rest of screen)
  - [ ] Speech bubble with short instructions
  - [ ] "Got it" / "?" buttons
  - [ ] Animated arrow pointing to relevant UI

### Progressive Mechanic Introduction (AC: 2)

- [ ] Combat 1: Basic Cards
  - [ ] Spotlight hand: "These are your cards"
  - [ ] Highlight attack card: "Click to deal damage"
  - [ ] After damage: "Nice! The enemy lost HP"
  - [ ] Show End Turn: "End your turn when done"
  - [ ] After enemy turn: "They attack back—watch your HP"
- [ ] Combat 2: Defense
  - [ ] Introduce block card: "This card gives Block"
  - [ ] Explain block: "Block absorbs damage"
  - [ ] Show block disappearing: "Block resets each turn"
- [ ] Combat 3: Resolve/Energy
  - [ ] Highlight resolve counter: "Cards cost Resolve"
  - [ ] Show unplayable card: "Can't afford this one yet"
  - [ ] Explain resolve reset: "Resolve refills each turn"
- [ ] Combat 4: Status Effects
  - [ ] When enemy has status: "See the icon? That's a status effect"
  - [ ] Explain buffs/debuffs briefly
- [ ] Beyond Combat 4: No more prompts
  - [ ] Player has core knowledge
  - [ ] Advanced mechanics self-discovered

### Universal Tooltips (AC: 3)

- [ ] Implement glossary term system
  - [ ] Mark all game terms (Block, Resolve, Devotion, etc.)
  - [ ] Terms are underlined/highlighted in text
  - [ ] Hover/tap shows definition
- [ ] Tooltip content
  - [ ] Term name
  - [ ] Short definition (1 sentence)
  - [ ] Example if helpful
- [ ] Tooltip design
  - [ ] Appears near cursor/finger
  - [ ] Doesn't cover important UI
  - [ ] Dismisses on mouse away / tap elsewhere
- [ ] Terms to define
  - [ ] Block
  - [ ] Resolve
  - [ ] Draw Pile / Discard Pile / Exhaust
  - [ ] Status Effects (each type)
  - [ ] Attack / Skill / Power card types
  - [ ] Class-specific resources

### Class Mechanic Tutorials (AC: 4)

- [ ] Trigger on first run with new class
  - [ ] "The Cleric's Devotion" popup
  - [ ] Shows icon, brief explanation
  - [ ] In-game example callout
- [ ] Class tutorial content
  - [ ] Cleric: "Healing builds Devotion. Spend it on powerful cards."
  - [ ] Knight: "Fortify is Block that doesn't fade. Stack it up!"
  - [ ] Diabolist: "Contracts add Curses—powerful but dangerous."
  - [ ] Oathsworn: "Vows give power but have restrictions. Break them at your peril."
  - [ ] Fey-Touched: "Whimsy cards have random effects. Build Luck to control fate."
  - [ ] Celestial: "Radiance empowers holy spells. Reach max for Divine Form!"
  - [ ] Summoner: "Minions fight for you. Protect and empower them!"
- [ ] Interactive demo
  - [ ] First card that uses mechanic shows preview
  - [ ] "Try it now!" prompt

### Always-Available Help (AC: 5)

- [ ] "?" button on key UI elements
  - [ ] Near player stats
  - [ ] On card type labels
  - [ ] On status effect icons
- [ ] Help triggers context-appropriate info
  - [ ] Click "?" near HP → HP explanation
  - [ ] Click "?" on card → Card anatomy
- [ ] Long-press anywhere for contextual help
  - [ ] On enemy → Enemy info
  - [ ] On card → Card details
  - [ ] On status → Status explanation

### Skip Tutorial Option (AC: 6)

- [ ] Global skip option
  - [ ] "Skip all tutorials" in settings
  - [ ] Immediately goes to full game
- [ ] Per-step skip
  - [ ] Each tutorial step has "Skip" button
  - [ ] Skipping one doesn't skip others
- [ ] Resume capability
  - [ ] If player skips, can access tutorials from help menu
  - [ ] "Tutorial: Combat Basics" option

### Contextual Stuck Hints (AC: 7)

- [ ] Detect stuck states
  - [ ] 30+ seconds without action
  - [ ] Multiple failed card plays
  - [ ] Low HP without playing defensive cards
- [ ] Gentle hint system
  - [ ] Subtle highlight appears on recommended action
  - [ ] Optional "Need help?" prompt
  - [ ] Never forces action
- [ ] Hint examples
  - [ ] Stuck: Card glows slightly
  - [ ] Low HP: "Consider using Block cards"
  - [ ] Full hand: "You can't draw more. Play some cards!"
  - [ ] All enemies dead: "Click End Turn to finish"

### Help Menu/Glossary (AC: 8)

- [ ] Accessible from pause/settings
  - [ ] "How to Play" section
  - [ ] "Glossary" searchable list
- [ ] How to Play content
  - [ ] Combat basics (1 page)
  - [ ] Card types (1 page)
  - [ ] Map navigation (1 page)
  - [ ] Tips & strategies (1 page)
- [ ] Glossary
  - [ ] Alphabetical term list
  - [ ] Search/filter functionality
  - [ ] Each term links to related terms

## Dev Notes

### Tutorial Step Data Structure

```typescript
interface TutorialStep {
  id: string;
  trigger: TutorialTrigger;
  spotlight?: SpotlightConfig;
  message: string;
  position: 'top' | 'bottom' | 'left' | 'right';
  arrow?: { target: string; direction: string };
  buttons: { label: string; action: 'next' | 'skip' | 'help' }[];
  prerequisite?: string; // Previous step ID
  condition?: () => boolean; // Dynamic show condition
}

interface TutorialTrigger {
  type: 'combat_start' | 'card_hover' | 'turn_end' | 'enemy_action' | 'first_time';
  data?: any;
}

const COMBAT_TUTORIAL: TutorialStep[] = [
  {
    id: 'intro-hand',
    trigger: { type: 'combat_start' },
    spotlight: { element: '#hand', padding: 10 },
    message: 'These are your cards. Each card costs Resolve to play.',
    position: 'top',
    arrow: { target: '#hand', direction: 'down' },
    buttons: [{ label: 'Got it', action: 'next' }]
  },
  {
    id: 'play-attack',
    trigger: { type: 'first_time' },
    spotlight: { element: '.card.attack', padding: 5 },
    message: 'Click this Attack card to deal damage to the enemy.',
    position: 'top',
    buttons: [
      { label: 'Show me', action: 'highlight' },
      { label: 'Skip', action: 'skip' }
    ],
    prerequisite: 'intro-hand'
  },
  // ... more steps
];
```

### Spotlight Overlay Component

```typescript
class SpotlightOverlay {
  private overlay: HTMLElement;
  private hole: HTMLElement;

  show(config: SpotlightConfig): void {
    const target = document.querySelector(config.element);
    if (!target) return;

    const rect = target.getBoundingClientRect();

    // Create dark overlay with hole
    this.overlay = document.createElement('div');
    this.overlay.className = 'tutorial-overlay';

    this.hole = document.createElement('div');
    this.hole.className = 'spotlight-hole';
    this.hole.style.cssText = `
      left: ${rect.left - config.padding}px;
      top: ${rect.top - config.padding}px;
      width: ${rect.width + config.padding * 2}px;
      height: ${rect.height + config.padding * 2}px;
    `;

    document.body.appendChild(this.overlay);
    document.body.appendChild(this.hole);
  }

  hide(): void {
    this.overlay?.remove();
    this.hole?.remove();
  }
}
```

### CSS for Tutorial Elements

```css
/* Tutorial overlay */
.tutorial-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 9000;
  pointer-events: none;
}

.spotlight-hole {
  position: fixed;
  border-radius: 8px;
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
  z-index: 9001;
  pointer-events: none;
  animation: spotlight-pulse 2s ease-in-out infinite;
}

@keyframes spotlight-pulse {
  0%, 100% { box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7); }
  50% { box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.65), 0 0 30px 10px rgba(255, 215, 0, 0.3); }
}

/* Tutorial bubble */
.tutorial-bubble {
  position: fixed;
  max-width: 300px;
  padding: 16px;
  background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
  border: 2px solid gold;
  border-radius: 12px;
  color: white;
  z-index: 9002;
  animation: bubble-enter 0.3s ease-out;
}

@keyframes bubble-enter {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tutorial-bubble::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  background: #2d2d44;
  border: 2px solid gold;
  border-top: none;
  border-left: none;
  transform: rotate(45deg);
}

.tutorial-bubble.arrow-down::after {
  bottom: -12px;
  left: 50%;
  margin-left: -10px;
}

/* Tutorial buttons */
.tutorial-bubble .btn-row {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.tutorial-bubble button {
  flex: 1;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.1s;
}

.tutorial-bubble button:hover {
  transform: scale(1.05);
}

.tutorial-bubble button.primary {
  background: gold;
  color: #1a1a2e;
}

.tutorial-bubble button.secondary {
  background: transparent;
  border: 1px solid #666;
  color: #ccc;
}

/* Glossary tooltip */
.glossary-term {
  border-bottom: 1px dotted #888;
  cursor: help;
}

.glossary-tooltip {
  position: absolute;
  max-width: 250px;
  padding: 12px;
  background: #1a1a2e;
  border: 1px solid gold;
  border-radius: 8px;
  font-size: 0.9em;
  z-index: 8000;
  pointer-events: none;
  animation: tooltip-fade 0.2s ease-out;
}

@keyframes tooltip-fade {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}
```

### Stuck Detection System

```typescript
class StuckDetector {
  private lastActionTime: number = Date.now();
  private failedPlayCount: number = 0;

  onAction(): void {
    this.lastActionTime = Date.now();
    this.failedPlayCount = 0;
  }

  onFailedPlay(): void {
    this.failedPlayCount++;
    if (this.failedPlayCount >= 3) {
      this.showHint('insufficient-resolve');
    }
  }

  tick(): void {
    const idleTime = Date.now() - this.lastActionTime;

    if (idleTime > 30000) { // 30 seconds
      this.showSubtleHint();
    }
  }

  private showSubtleHint(): void {
    // Gently highlight a playable card
    const playableCard = document.querySelector('.card.playable');
    if (playableCard) {
      playableCard.classList.add('hint-glow');
      setTimeout(() => playableCard.classList.remove('hint-glow'), 3000);
    }
  }

  private showHint(hintId: string): void {
    // Show contextual hint based on ID
    const hints: Record<string, string> = {
      'insufficient-resolve': 'That card costs more Resolve than you have. Try a cheaper card!',
      'low-hp': 'Your HP is low! Consider playing defense cards.',
      'combat-won': 'All enemies defeated! Click End Turn to claim victory.',
    };

    if (hints[hintId]) {
      // Display hint toast
      showToast(hints[hintId], 'info');
    }
  }
}
```

## Testing

### Test Scenarios

1. New player sees tutorial prompt
2. Tutorial progresses step by step
3. Tooltips appear on hover/tap for all terms
4. Each class has specific mechanic tutorial
5. Help button shows context-appropriate info
6. Tutorial can be skipped at any point
7. Stuck hints appear after inactivity
8. Glossary is searchable and complete

### Usability Testing

- [ ] Test with deck-builder newcomers
- [ ] Test with experienced deck-builder players
- [ ] Measure time to complete first combat
- [ ] Track skip rates on tutorial steps
- [ ] Survey: "Did you understand the game mechanics?"

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-04 | 1.0 | Initial story creation | Sally (UX) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
