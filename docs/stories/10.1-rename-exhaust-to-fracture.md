# Story 10.1: Rename "Exhaust" to "Fracture"

## Status: Ready for Review

## Story

**As a** player of Sanctum Ruins,
**I want** the card removal mechanic to be called "Fracture" instead of "Exhaust",
**so that** our game has unique terminology that fits the lore (and avoids Slay the Spire confusion).

## Acceptance Criteria

1. All instances of "Exhaust" renamed to "Fracture" in code
2. All UI text shows "Fracture" instead of "Exhaust"
3. Card descriptions use "Fracture" terminology
4. Tooltip/help text explains what Fracture means
5. Alternative names considered: "Exile" or "Forget" (Hollow God thematic)
6. Codebase search confirms no remaining "exhaust" references (gameplay context)

## Naming Options

| Option | Pros | Cons |
|--------|------|------|
| **Fracture** | Fits world (shattered memories), unique | Less intuitive |
| **Exile** | Common CCG term, clear meaning | Used by other games (MTG) |
| **Forget** | Perfect Hollow God tie-in | Might confuse with Forget attack |

**Recommendation**: Use **"Fracture"** - unique to Sanctum, fits the shattered/broken theme

## Tasks / Subtasks

- [x] Decide final terminology (AC: 5)
  - [x] Confirm "Fracture" or choose alternative
- [x] Update type definitions (AC: 1)
  - [x] Rename ExhaustEffect → FractureEffect (or similar)
  - [x] Update CardEffect types
- [x] Update CombatEngine (AC: 1)
  - [x] Rename exhaust pile → fracture pile
  - [x] Update all exhaust logic
- [x] Update card definitions (AC: 3)
  - [x] Search/replace in card text
  - [x] Update effect references
- [x] Update UI text (AC: 2)
  - [x] Combat UI labels
  - [x] Deck viewer
  - [x] Tooltips
- [ ] Add help text (AC: 4)
  - [ ] "Fracture: Remove this card from combat. Fractured cards return to your deck after combat."
- [x] Verification search (AC: 6)
  - [x] grep for "exhaust" in gameplay contexts
  - [x] Ensure nothing missed

## Dev Notes

### Lore Justification
In Sanctum Ruins, identity and memory are fragile. When a card is "Fractured," you're not just discarding it—you're temporarily losing a piece of your fighting capability, like a memory slipping away in the presence of the Hollow God.

### Technical Scope
- Type rename: `isExhaust` → `isFracture`, etc.
- Variable rename: `exhaustPile` → `fracturePile`
- UI string changes
- Card description changes

### Relevant Files
- `src/types/index.ts` - effect types
- `src/engine/CombatEngine.ts` - exhaust pile logic
- `src/data/cards/**/*.ts` - card descriptions
- `src/ui/renderer.ts` - UI labels

### Testing
- Full game playthrough to verify no "exhaust" text appears
- Unit tests still pass after rename

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-04 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### File List
**Modified Source Files:**
- `src/types/index.ts` - Renamed exhaust → fracture in types (EffectType, CardDefinition, PlayerState, CombatState, CombatEventType, UpgradeEffect)
- `src/engine/CombatEngine.ts` - Updated all exhaust logic to fracture
- `src/main.ts` - Updated fracturePile initialization and event handling
- `src/services/UpgradeEffects.ts` - Renamed curseStartExhausted → curseStartFractured
- `src/data/upgrades.ts` - Updated description and effect type
- `src/data/enemies/act3-boss.ts` - Updated comments
- `src/ui/renderer.ts` - Updated comment
- `src/styles/main.css` - Renamed CSS classes: permanently-exhausted-* → permanently-fractured-*

**Modified Card Files:**
- `src/data/cards/diabolist.ts` - Updated descriptions and properties
- `src/data/cards/celestial.ts` - Updated fracture property
- `src/data/cards/summoner.ts` - Updated fracture property
- `src/data/cards/cleric.ts` - Updated fracture property
- `src/data/cards/oathsworn.ts` - Updated descriptions and properties
- `src/data/cards/knight.ts` - Updated descriptions and properties
- `src/data/cards/bargainer.ts` - Updated fracture property
- `src/data/cards/fey_touched.ts` - Updated descriptions and properties

**Modified Test Files:**
- `src/data/oathsworn-cards.test.ts` - Updated assertions
- `src/data/oathsworn.test.ts` - Updated mock data
- `src/data/fey-touched-cards.test.ts` - Updated assertions
- `src/data/diabolist-cards.test.ts` - Updated assertions
- `src/engine/CombatEngine.test.ts` - Updated mock data
- `src/services/NarrativeEventService.test.ts` - Updated mock data
- `src/data/enemies/act3-boss.test.ts` - Updated test name and assertions
- All other test files - Updated fracturePile: [] in mock PlayerState

### Change Log
| Date | Change | File |
|------|--------|------|
| 2025-12-05 | Renamed EffectType.EXHAUST_CURSE_FROM_HAND → FRACTURE_CURSE_FROM_HAND | src/types/index.ts |
| 2025-12-05 | Renamed CardDefinition.exhaust → fracture | src/types/index.ts |
| 2025-12-05 | Renamed CardDefinition.exhaustOnDiscard → fractureOnDiscard | src/types/index.ts |
| 2025-12-05 | Renamed PlayerState.exhaustPile → fracturePile | src/types/index.ts |
| 2025-12-05 | Renamed CombatState.permanentlyExhaustedCards → permanentlyFracturedCards | src/types/index.ts |
| 2025-12-05 | Renamed CombatEventType.CARD_PERMANENTLY_EXHAUSTED → CARD_PERMANENTLY_FRACTURED | src/types/index.ts |
| 2025-12-05 | Updated all CombatEngine exhaust logic to fracture | src/engine/CombatEngine.ts |
| 2025-12-05 | Renamed permanentlyExhaustRandomCard → permanentlyFractureRandomCard | src/engine/CombatEngine.ts |
| 2025-12-05 | Updated all card descriptions from "Exhaust" to "Fracture" | src/data/cards/*.ts |
| 2025-12-05 | Updated CSS classes: permanently-exhausted-* → permanently-fractured-* | src/styles/main.css |
| 2025-12-05 | Updated all test files with new property names | src/**/*.test.ts |

### Completion Notes
- All "exhaust" terminology changed to "fracture" across the codebase
- Card descriptions use "Fracture" (e.g., "Deal 30 damage. Fracture.")
- Curses now say "Fractures when discarded" instead of "Exhausts when discarded"
- Type system updated: exhaust → fracture, exhaustPile → fracturePile
- Engine uses fracturePile for storing removed cards
- CSS classes renamed for consistency
- All 896 tests pass
- Build successful
- Note: Help text tooltip (AC: 4) not yet implemented - requires separate UI work

---

## QA Results

### QA Agent: Claude Opus 4.5
### Date: 2025-12-05
### Status: PASSED WITH EXCEPTION

### Acceptance Criteria Verification

| AC | Description | Result | Evidence |
|----|-------------|--------|----------|
| 1 | All "Exhaust" renamed to "Fracture" in code | ✅ PASS | Types, engine, cards all use fracture terminology |
| 2 | UI text shows "Fracture" | ✅ PASS | No "Exhaust" in src/ui/ - verified via grep |
| 3 | Card descriptions use "Fracture" | ✅ PASS | All card files updated (diabolist, oathsworn, knight, fey_touched, etc.) |
| 4 | Tooltip/help text explains Fracture | ❌ FAIL | No tooltip implemented - noted in Dev Agent Record |
| 5 | Alternative names considered | ✅ PASS | Story documents Fracture/Exile/Forget options |
| 6 | No remaining "exhaust" references | ✅ PASS | Only 1 reference: elites.test.ts:282 (enemy AI context, not player cards) |

### Test Results
- Build: ✅ Successful
- Unit Tests: ✅ 897/897 passed

### Codebase Verification
```
grep -ri "exhaust" src/ --include="*.ts" results:
- elites.test.ts:282 - Comment about enemy move exhaustion (acceptable, different concept)
- No other gameplay-context "exhaust" references
```

### Files Verified Modified
- `src/types/index.ts` - Type renames (exhaust → fracture)
- `src/engine/CombatEngine.ts` - All exhaust logic → fracture
- `src/data/cards/*.ts` - Card descriptions updated
- `src/styles/main.css` - CSS classes renamed
- All test files updated

### Exception
**AC:4 NOT IMPLEMENTED**: Help tooltip for Fracture not yet added. Dev Agent Record documents this as pending separate UI work. Recommend creating follow-up story for tooltip implementation.
