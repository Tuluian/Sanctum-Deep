# Story 4.1: Act 2 Common Enemies (Sunken Crypts)

## Status: Draft

## Story

**As a** player exploring Act 2,
**I want** challenging enemies themed around dark magic and aberrations,
**so that** I face escalating difficulty with new mechanics to master.

---

## Narrative Context: The Flooded Depths

> *"The deeper chambers hold those who survived longer before failing. They made deals. They merged. They became something other than what they were."*

### Act 2 Theme: Corruption and Bargains

These enemies are not the freshly-fallen. They're souls who lastedâ€”who made compromises to survive, who bargained with the Hollow God, who lost themselves slowly instead of all at once.

The tragedy here is different from Act 1. These enemies *chose* this. Every dark mage knew the cost. Every cultist chanted willingly. Their fall was gradual, and somewhere inside, they might still know what they lost.

### Design Philosophy

Act 2 enemies should feel like:
- Corrupted intelligence, not mindless echoes
- Deals gone wrong
- Survival at the cost of self
- The horror of *almost* being human

---

## Enemy Roster: The Bargainers

### 1. Slime
**HP:** 45 | **Role:** Spawner

**What It Was:** Multiple souls merged into one mass. When the Hollow God couldn't fully consume several delvers at once, it... combined them. The Slime contains fragments of a dozen identities, none dominant, all screaming.

**Death Quote:** *[Multiple overlapping voices]* "We're... separate now? I... I remember my name. It wasâ€”" *[Silence. Too late.]*

**Visual Notes:** Faces occasionally surface in the massâ€”not horrified, but confused. Reaching toward something they can't remember.

**When Split Triggers:**
> *[A face separates from the mass, forming the Slimeling]*
> "Don't go... we were almost whole... we were almost..."

---

### 2. Slimeling
**HP:** 15 | **Role:** Minion

**What It Was:** A single soul fragment, separated from the collective. For a brief moment, they remember being one person.

**Death Quote:** *"I had a name. I had a family. I hadâ€”"* *[Absorbed back into nothing.]*

**Merge Quote (when healing parent):** *"Coming back... it's warm... I don't have to remember alone..."*

---

### 3. Dark Mage
**HP:** 35 | **Role:** Caster

**What They Were:** Wizards who entered seeking knowledge of the void. The Hollow God taught themâ€”and teaching is consuming here. They can still cast, but the spells taste like ash.

**Death Quote:** *"I learned too much. I learned what's behind everything. It's... nothing. It was always nothing."*

**Visual Notes:** Robes are pristine but they're fadingâ€”becoming translucent. You can see the void behind them.

**Combat Dialogue:**
- Dark Shield: *"The void protects. The void provides. The void... is all I have now."*
- Curse of Weakness: *"Let me share what I've learned. Let me share the weight."*

---

### 4. Gargoyle
**HP:** 55 | **Role:** Tank

**What It Was:** Not a personâ€”a construct created by the Drowned King to guard his crypts. When the King fell, the Gargoyles lost their purpose. They guard... everything. They attack... everyone.

**Death Quote:** *[Grinding stone]* "Purpose... purpose... I was built to... to..."* *[Crumbles. A mason's mark is visible inside: "For Thalassar."]*

**Visual Notes:** Water damage. Barnacles. Cracks filled with dried seaweed. They've been standing still in flooded rooms for four hundred years.

**Awakening Dialogue:** *"INTRUDER DETECTED. PROTOCOL: DESTROY. DIRECTIVE: PROTECT. CONTRADICTION: UNRESOLVED."*

---

### 5. Corrupted Spirit
**HP:** 30 | **Role:** Debuffer

**What They Were:** A soul that died but didn't leave. They wanted revenge on somethingâ€”the Sanctum, the Hollow God, themselvesâ€”and that want kept them here. Now they don't remember what they wanted. They just... hurt.

**Death Quote:** *"I stayed because I was angry. I don't remember at what. Was it you? Did you wrong me? I... I can't remember. I'm sorry."*

**Visual Notes:** Translucent, flickering. When they attack, you see a flash of who they wereâ€”then it's gone.

**Combat Dialogue:**
- Corrupt: *"Take some of this. Take the pain. I have so much. Too much."*
- Wail: *"EVERYONE HURTS! EVERYONE SHOULD HURT! I SHOULDN'T HURT ALONE!"*

---

### 6. Aberration
**HP:** 50 | **Role:** Bruiser

**What They Were:** Two souls, merged wrong. When the Hollow God tried to consume two delvers who were holding handsâ€”lovers, siblings, friendsâ€”it couldn't separate them. Now they're neither person. They're a mistake.

**Death Quote:** *[Two voices, harmonizing sadly]* "We stayed together. We thought... we thought that would save us. We were wrong. At least we were wrong together."*

**Visual Notes:** Two faces, fused. Four arms, uncoordinated. They move like two people trying to share one body.

**Combat Dialogue:**
- Flailing Strike: *[Voice 1]* "I'll hit them!" *[Voice 2]* "No, I will!"
- Tormented Cry: *[Both]* "MAKE IT STOP. PLEASE. JUST MAKE IT STOP."*

---

### 7. Drowned Cultist
**HP:** 38 | **Role:** Support

**What They Were:** True believers who came to serve the Drowned King. They stayed after his fall, tending to flooded altars, chanting prayers to a monarch who can't hear them.

**Death Quote:** *"The King will return. The King will save us. The King will... the King... was there a king? Was there ever a king?"*

**Visual Notes:** Waterlogged robes, webbed fingers. They've been underwater so long they've started to adapt.

**Combat Dialogue:**
- Ritual Chant: *"All hail Thalassar! All hail the Drowned King! All hail... all hail..."*
- Sacrifice: *"For the kingdom! For the children! For the love that drowned a throne!"*

---

### 8. Deep One
**HP:** 48 | **Role:** Elite-lite

**What They Were:** Originally a fisher from the coast near Thalassar. When the kingdom flooded, they tried to save the children. The water changed them. Now they are children of the deepâ€”and they remember nothing of the sun.

**Death Quote:** *"The surface... I used to live there. There was light. There was air. There were people I loved. I dove down to save them. I never came back up."*

**Visual Notes:** Fish-like features, scales, gills. Still wearing scraps of a fisherman's clothes. A child's bracelet on one wristâ€”fused to the skin.

**Combat Dialogue:**
- Drown: *"Come down. Come to the depths. It's quiet here. Nothing hurts here."*
- Regenerate: *"The water heals. The water changes. The water remembers."*

---

## Encounter Design: Corruption Spreads

Act 2 encounters should feel like *groups that enabled each other's fall*.

### Easy Encounters (60-75 HP total)
| Enemies | Flavor |
|---------|--------|
| Solo Dark Mage | *"A scholar, alone with their terrible knowledge."* |
| Drowned Cultist + Corrupted Spirit | *"The believer and the doubt. They argue even now."* |

### Medium Encounters (75-100 HP total)
| Enemies | Flavor |
|---------|--------|
| Slime | *"They couldn't escape alone. Now they can't escape at all."* |
| Dark Mage + Gargoyle | *"The wizard reactivated the guardian. The guardian follows orders it doesn't understand."* |
| Aberration + Corrupted Spirit | *"The merged and the lingering. Misery loves company."* |

### Hard Encounters (100-120 HP total)
| Enemies | Flavor |
|---------|--------|
| Deep One + Drowned Cultist + Drowned Cultist | *"The fisher and the flock. They pray to different waters."* |
| Dark Mage + Dark Mage + Corrupted Spirit | *"A study group. They shared notes. They shared doom."* |
| Gargoyle + Gargoyle | *"Twin sentinels. They were carved by the same hand."* |

---

## Class-Specific Enemy Interactions

### Cleric vs. Corrupted Spirit
Spirit: *"You have faith. I remember faith. It didn't save me. Will it save you?"*

### Knight vs. Gargoyle
Gargoyle: *"SEALED GATE DESIGNATION... RECOGNIZED. OVERRIDE: FAILED. MUST DESTROY."*
(The Order helped create the Gargoyles. They recognize Knight-class armor.)

### Diabolist vs. Dark Mage
Mage: *"Another bargainer. Your contract smells of brimstone. Mine smells of nothing. Neither of us will pay fair price."*

### Oathsworn vs. Drowned Cultist
Cultist: *"You carry vows like chains. The King was chained to his love. Look where it got him. Look where it gets you."*

### Fey-Touched vs. Aberration
Aberration: *"You're touched by chaos. We're touched by merging. Chaos and unity. Both hurt. Both change."*

---

## Acceptance Criteria

1. Act 2 has 8 common enemy types
2. Each enemy has unique HP, moves, and weighted AI patterns
3. Enemies telegraph their intents clearly
4. Enemies fit the "Sunken Crypts" theme (Aberrations/Dark Magic)
5. Enemy difficulty scales appropriately for Act 2 (mid game)
6. Combat can spawn 1-3 enemies per encounter
7. New mechanics introduced: Corrupt, Magic Shield, Soul Link
8. **NEW: Each enemy has backstory and death quote**
9. **NEW: Encounter groups tell micro-stories**
10. **NEW: Class-specific enemy dialogue**

## Tasks / Subtasks

- [ ] Design 8 Act 2 common enemies (AC: 1, 4, 5)
  - [ ] **Slime** (45 HP) - Splits when damaged
    - Engulf (Attack 6, 50%)
    - Acidic Touch (Attack 4, Apply 2 Sundered, 30%)
    - Split (If HP < 50%, spawn Slimeling, 20%)
  - [ ] **Slimeling** (15 HP) - Spawned minion
    - Splash (Attack 3, 70%)
    - Merge (Heal parent Slime 10, 30%)
  - [ ] **Dark Mage** (35 HP) - Spell caster
    - Shadow Bolt (Attack 8, 40%)
    - Dark Shield (Gain 12 Magic Shield, 30%)
    - Curse of Weakness (Apply Impaired 2 turns, 30%)
  - [ ] **Gargoyle** (55 HP) - Stone defender
    - Stone Fist (Attack 7, 35%)
    - Petrify (Block 15, 35%)
    - Awakening (Attack 10, only if took damage last turn, 30%)
  - [ ] **Corrupted Spirit** (30 HP) - Debuffer
    - Soul Rend (Attack 5, 35%)
    - Corrupt (Apply Corrupt 2, deals damage when playing cards, 35%)
    - Wail (All enemies gain 5 block, 30%)
  - [ ] **Aberration** (50 HP) - Merged souls enemy
    - Flailing Strike (Attack 4 twice, 40%)
    - Absorb (Attack 6, Heal 6, 30%)
    - Tormented Cry (Apply Impaired 1 turn to player, Sundered 1 turn to self, 30%)
  - [ ] **Drowned Cultist** (38 HP) - Ritual caster
    - Water Bolt (Attack 7, 40%)
    - Ritual Chant (Gain 2 Might, 35%)
    - Sacrifice (Lose 10 HP, all allies gain 8 block, 25%)
  - [ ] **Deep One** (48 HP) - Amphibian horror
    - Claw Swipe (Attack 9, 45%)
    - Regenerate (Heal 8, 30%)
    - Drown (Attack 5, Apply Bound 1 turn - can't play Skills, 25%)

- [ ] Implement enemy definitions (AC: 2, 3)
  - [ ] Create `src/data/enemies/act2.ts`
  - [ ] Add all 8 enemies with proper move definitions
  - [ ] Define moves with proper intent types
  - [ ] Set appropriate weights for move selection

- [ ] Implement new Act 2 mechanics (AC: 7)
  - [ ] **Corrupt** status: Take X damage when playing a card
  - [ ] **Magic Shield**: Block that absorbs spell damage first
  - [ ] **Spawn** mechanic: Slime creating Slimelings
  - [ ] **Bound** status: Can't play cards of specific type
  - [ ] **Conditional moves**: Gargoyle's Awakening only after taking damage

- [ ] Update CombatEngine for new mechanics
  - [ ] Handle SPAWN intent type (create new enemy mid-combat)
  - [ ] Handle Corrupt damage on card play
  - [ ] Handle Magic Shield reduction
  - [ ] Handle conditional move availability
  - [ ] Track "took damage last turn" for Gargoyle

- [ ] Update UI for new mechanics (AC: 3)
  - [ ] Corrupt status icon (â˜ ï¸)
  - [ ] Magic Shield indicator (distinct from regular block)
  - [ ] Spawn animation (enemy splitting)
  - [ ] Bound status icon (ðŸ”—)

- [ ] Create encounter configurations
  - [ ] Define which enemies can appear together
  - [ ] Define encounter difficulty tiers
  - [ ] Balance HP totals per encounter (target: 60-120 HP total for Act 2)

- [ ] Write unit tests
  - [ ] Test each enemy has correct HP and moves
  - [ ] Test Slime spawns Slimeling at low HP
  - [ ] Test Corrupt deals damage on card play
  - [ ] Test Magic Shield absorbs damage
  - [ ] Test conditional moves work correctly
  - [ ] Test Bound prevents specific card types

## Dev Notes

### Act 2 Narrative Theme

From IDEAS-Narrative-Architecture:
> "The deeper chambers hold those who survived longer before failing â€” dark mages who bargained with the Hollow God, aberrations formed from merged souls, gargoyles that were once stone guardians driven mad."

These enemies represent corruption and bargains. They're more complex than Act 1's "echoes" - these are souls who made deals and lost themselves slowly.

### Enemy Design Philosophy (Act 2)

Act 2 enemies should:
- Introduce multi-mechanic enemies
- Require strategic target prioritization
- Punish passive play (Corrupt, Regenerate)
- Have higher damage and HP than Act 1
- Include at least one "spawner" enemy

### New Status Effects

```typescript
// Corrupt: Take damage when playing cards
interface CorruptStatus {
  type: StatusType.CORRUPT;
  amount: number; // Damage per card played
  duration?: number; // Turns, or until cleansed
}

// Bound: Can't play certain card types
interface BoundStatus {
  type: StatusType.BOUND;
  cardType: CardType; // ATTACK, SKILL, or POWER
  duration: number;
}
```

### Spawn Mechanic

```typescript
interface SpawnMove extends EnemyMove {
  intent: IntentType.SPAWN;
  spawnId: string; // Enemy definition to spawn
  condition?: {
    type: 'hp_below';
    threshold: number; // Percentage (0.5 = 50%)
  };
}

// Slime spawning logic
function executeSpawn(enemy: Enemy, move: SpawnMove): void {
  const spawn = createEnemy(move.spawnId);
  spawn.id = `${spawn.id}_${Date.now()}`; // Unique instance
  state.enemies.push(spawn);
  emit(CombatEventType.ENEMY_SPAWNED, { parent: enemy.id, spawn });
}
```

### Magic Shield

Magic Shield is a variant of block that:
- Absorbs damage from spell/skill cards first
- Doesn't decay at turn end (persists like Fortify)
- Caps at 20
- Shown differently in UI (blue shimmer)

```typescript
interface Enemy {
  // ... existing
  magicShield: number;
}

function dealDamage(target: Enemy, amount: number, source: Card): void {
  if (source.type === CardType.SKILL && target.magicShield > 0) {
    const absorbed = Math.min(target.magicShield, amount);
    target.magicShield -= absorbed;
    amount -= absorbed;
  }
  // Continue with normal block/HP damage
}
```

### Enemy Definitions

```typescript
const DARK_MAGE: EnemyDefinition = {
  id: 'dark_mage',
  name: 'Dark Mage',
  maxHp: 35,
  moves: [
    { id: 'shadow_bolt', name: 'Shadow Bolt', intent: IntentType.ATTACK, damage: 8, weight: 40 },
    { id: 'dark_shield', name: 'Dark Shield', intent: IntentType.DEFEND, magicShield: 12, weight: 30 },
    { id: 'curse_weakness', name: 'Curse of Weakness', intent: IntentType.DEBUFF,
      status: { type: StatusType.IMPAIRED, duration: 2 }, weight: 30 },
  ],
};

const SLIME: EnemyDefinition = {
  id: 'slime',
  name: 'Slime',
  maxHp: 45,
  moves: [
    { id: 'engulf', name: 'Engulf', intent: IntentType.ATTACK, damage: 6, weight: 50 },
    { id: 'acidic_touch', name: 'Acidic Touch', intent: IntentType.ATTACK, damage: 4,
      status: { type: StatusType.SUNDERED, amount: 2 }, weight: 30 },
    { id: 'split', name: 'Split', intent: IntentType.SPAWN, spawnId: 'slimeling',
      condition: { type: 'hp_below', threshold: 0.5 }, weight: 20 },
  ],
};
```

### Encounter Examples

```typescript
// Easy Act 2 encounter
{ enemies: ['drowned_cultist'] }

// Medium encounter
{ enemies: ['dark_mage', 'corrupted_spirit'] }

// Hard encounter
{ enemies: ['slime', 'gargoyle'] } // Slime splits, Gargoyle tanks

// Thematic encounter - "The Bargainers"
{ enemies: ['dark_mage', 'drowned_cultist', 'corrupted_spirit'] }
```

### Balance Targets

| Enemy | HP | Avg Damage/Turn | Role |
|-------|-----|-----------------|------|
| Slime | 45 | 5.4 | Spawner |
| Slimeling | 15 | 3.0 | Minion |
| Dark Mage | 35 | 5.6 | Caster |
| Gargoyle | 55 | 6.5 | Tank |
| Corrupted Spirit | 30 | 4.5 | Debuffer |
| Aberration | 50 | 6.0 | Bruiser |
| Drowned Cultist | 38 | 5.2 | Support |
| Deep One | 48 | 7.2 | Elite-lite |

## Testing

### Test File Location
`src/tests/enemies/Act2Enemies.test.ts`

### Key Test Scenarios

1. **Enemy Stats**: Each enemy has correct HP
2. **Move Weights**: Moves selected according to weights
3. **Spawn**: Slime creates Slimeling at < 50% HP
4. **Corrupt**: Player takes damage when playing cards
5. **Magic Shield**: Absorbs skill damage before HP
6. **Conditional Move**: Gargoyle's Awakening requires previous damage
7. **Bound**: Player can't play bound card type
8. **Regenerate**: Deep One heals correctly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
