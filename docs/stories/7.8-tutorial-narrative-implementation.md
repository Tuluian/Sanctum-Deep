# Story 7.8: Tutorial Narrative Implementation

## Status: In Progress

## Story

**As a** new player entering the Sanctum for the first time,
**I want** an immersive tutorial that introduces mechanics through the Warden's narrative voice,
**so that** I learn how to play while becoming invested in the world and characters.

---

## Narrative Reference Document

**IMPORTANT**: All dialogue, Warden voice lines, class-specific greetings, and narrative content for this story are defined in:

**`docs/stories/tutorial-narrative.md`**

The dev agent MUST use the exact wording from that document. Do not invent or paraphrase dialogue—copy it verbatim from the narrative reference.

---

## Acceptance Criteria

1. Phase 0 entrance sequence displays with narrative text from reference doc
2. Warden greeting appears after class selection with class-specific dialogue
3. Card tutorial phase uses Warden's narrative explanations
4. Resolve/Energy tutorial uses Warden's narrative explanations
5. Block tutorial uses Warden's narrative explanations
6. Enemy intent tutorial uses Warden's narrative explanations
7. First combat includes Warden commentary and skeleton dialogue
8. Class-specific mechanic tutorials display correct Warden dialogue per class
9. Tutorial completion shows Warden's farewell narrative
10. Skip tutorial option shows returning player dialogue
11. In-game tooltips use Warden-voiced text from reference doc
12. Post-tutorial messages trigger at first elite, boss, shrine, and merchant

## Tasks / Subtasks

- [x] Implement Phase 0: Entrance Sequence (AC: 1)
  - [x] Create entrance screen overlay component
  - [x] Display "SANCTUM RUINS" title with dark doorway visual
  - [x] Show narrative intro text (copy from tutorial-narrative.md Phase 0)
  - [x] Transition to class selection

- [x] Implement Phase 1: Warden Greeting (AC: 2)
  - [x] Create Warden dialogue component with portrait/visual
  - [x] Display base Warden greeting (from tutorial-narrative.md Phase 1)
  - [x] Implement class-specific greeting variants:
    - [x] Cleric greeting
    - [x] Knight greeting
    - [x] Diabolist greeting
    - [x] Oathsworn greeting
    - [x] Fey-Touched greeting
    - [x] DLC class greetings (Celestial, Summoner, Bargainer, Tidecaller, Shadow Stalker, Goblin)
  - [x] Add click-to-advance dialogue system

- [ ] Implement Phase 2: Card Tutorial Narrative (AC: 3)
  - [ ] Display Warden's card explanation dialogue
  - [ ] Show tutorial prompt box for "PLAYING CARDS"
  - [ ] Display post-play Warden commentary

- [ ] Implement Phase 3: Resolve/Energy Tutorial Narrative (AC: 4)
  - [ ] Display Warden's resolve explanation dialogue
  - [ ] Show tutorial prompt box for "RESOLVE / ENERGY"

- [ ] Implement Phase 4: Block Tutorial Narrative (AC: 5)
  - [ ] Display Warden's block explanation dialogue
  - [ ] Spawn training dummy for demonstration
  - [ ] Show Warden commentary after block demonstration

- [ ] Implement Phase 5: Enemy Tutorial Narrative (AC: 6)
  - [ ] Display Warden's enemy introduction dialogue
  - [ ] Show tutorial prompt box for "ENEMY INTENTS"

- [ ] Implement Phase 6: First Combat Narrative (AC: 7)
  - [ ] Display Warden's combat start dialogue
  - [ ] Show skeleton enemy dialogue ("I had... a name...")
  - [ ] Display Warden's post-victory commentary

- [ ] Implement Phase 7: Class Mechanic Tutorials (AC: 8)
  - [ ] Create class mechanic explanation component
  - [ ] Implement Cleric: Devotion explanation
  - [ ] Implement Knight: Fortify explanation
  - [ ] Implement Diabolist: Soul Debt explanation
  - [ ] Implement Oathsworn: Vows explanation
  - [ ] Implement Fey-Touched: Luck/Whimsy explanation

- [ ] Implement Phase 8: Tutorial Completion (AC: 9)
  - [ ] Display Warden's farewell narrative sequence
  - [ ] Show "the choice" foreshadowing dialogue
  - [ ] Transition to main game

- [x] Implement Skip Tutorial Flow (AC: 10)
  - [x] Create returning player detection (localStorage flag)
  - [x] Skip entrance screen for returning players
  - [x] Skip Warden greeting for returning players

- [ ] Implement Warden-Voiced Tooltips (AC: 11)
  - [ ] Health bar tooltip
  - [ ] Draw pile tooltip
  - [ ] Discard pile tooltip
  - [ ] End Turn button tooltip
  - [ ] Enemy HP tooltip
  - [ ] Relic slot tooltip
  - [ ] Potion slot tooltip

- [x] Implement Post-Tutorial Messages (AC: 12)
  - [x] First Elite encounter Warden message
  - [x] First Boss encounter Warden message
  - [x] First Shrine Warden message
  - [x] First Merchant Warden message
  - [x] Track which messages have been shown (localStorage)

## Dev Notes

### Critical Instruction

**All narrative text MUST be copied exactly from `docs/stories/tutorial-narrative.md`.**

This includes:
- Warden dialogue (including stage directions in brackets)
- Class-specific greetings
- Tutorial prompt box text
- Tooltip text
- Post-tutorial messages

Do NOT paraphrase, shorten, or modify the writer's text.

### Dialogue Data Structure

```typescript
interface DialogueLine {
  speaker: 'narrator' | 'warden' | 'enemy';
  text: string;
  stageDirection?: string; // Text in [brackets] from the doc
}

interface TutorialPhase {
  id: string;
  dialogues: DialogueLine[];
  tutorialPrompt?: {
    title: string;
    lines: string[];
  };
}
```

### Class-Specific Content Map

Reference the following sections in tutorial-narrative.md:
- Cleric → "Phase 1: Meeting the Warden" → "Cleric" subsection
- Knight → "Phase 1: Meeting the Warden" → "Knight" subsection
- Diabolist → "Phase 1: Meeting the Warden" → "Diabolist" subsection
- Oathsworn → "Phase 1: Meeting the Warden" → "Oathsworn" subsection
- Fey-Touched → "Phase 1: Meeting the Warden" → "Fey-Touched" subsection

For class mechanics (Phase 7):
- Cleric: Devotion → "Phase 7: Class Mechanic Introduction" → "Cleric: Devotion"
- Knight: Fortify → "Phase 7: Class Mechanic Introduction" → "Knight: Fortify"
- etc.

### Integration with Story 7.5

This story implements the **narrative content** for the tutorial system. Story 7.5 implements the **mechanical systems** (spotlight overlays, tooltip infrastructure, stuck detection).

These stories should be implemented together or 7.5 first, as this story depends on:
- Tutorial overlay system from 7.5
- Spotlight mechanic from 7.5
- Tooltip infrastructure from 7.5

### Relevant Files

- `docs/stories/tutorial-narrative.md` - **SOURCE OF TRUTH** for all dialogue
- `src/ui/screens/TutorialScreen.ts` - New file for tutorial UI
- `src/data/tutorial-dialogue.ts` - New file for dialogue data
- `src/services/TutorialService.ts` - Tutorial state management
- `src/ui/components/WardenDialogue.ts` - Warden dialogue component

## Testing

- Test file location: `src/ui/screens/TutorialScreen.test.ts`
- Verify all dialogue matches tutorial-narrative.md exactly
- Test each class-specific greeting displays correctly
- Verify skip tutorial flow works for returning players
- Test all tooltips display Warden-voiced text
- Verify post-tutorial messages trigger once per account

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story creation from narrative document | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
N/A - UI implementation with visual testing

### Completion Notes List
**Phase 1 Implementation (Partial):**
- Created core tutorial infrastructure
- Implemented entrance screen (Phase 0)
- Implemented Warden greeting with all class-specific variants (Phase 1)
- Implemented post-tutorial first-encounter messages (Phase 12)
- Implemented skip tutorial flow for returning players (Phase 10)
- Added tutorial state management with localStorage persistence

**Remaining Work:**
- Phases 2-9: In-combat tutorial phases (requires Story 7.5 spotlight/overlay system)
- Phase 11: Warden-voiced tooltips

### File List
- `src/data/tutorialDialogue.ts` - NEW: All dialogue content from tutorial-narrative.md
- `src/services/TutorialService.ts` - NEW: Tutorial state management
- `src/ui/components/WardenDialogue.ts` - NEW: Dialogue display components
- `src/ui/screens/EntranceScreen.ts` - NEW: Entrance sequence screen
- `src/styles/main.css` - MODIFIED: Added Warden dialogue and entrance screen CSS
- `src/main.ts` - MODIFIED: Integrated tutorial system into game flow

---

## QA Results
_To be filled by QA agent_
