# Story 8.2: Greater Demon Self-Heal Fix

## Status: Draft

## Story

**As a** player fighting the Greater Demon elite,
**I want** the enemy's self-heal abilities to function correctly,
**so that** the fight has the intended difficulty and strategic considerations.

## Acceptance Criteria

1. Greater Demon's "Consume Minion" heal (20 HP) triggers correctly
2. Greater Demon's "Soul Harvest" lifesteal (18 HP) heals on damage dealt
3. Healing is applied to the enemy's current HP (not exceeding max)
4. Healing is visually reflected in the HP bar update
5. Combat log shows healing amount applied
6. Unit tests verify heal mechanics for elite enemies

## Tasks / Subtasks

- [ ] Investigate heal failure (AC: 1, 2)
  - [ ] Reproduce the bug in combat
  - [ ] Check CombatEngine heal intent processing
  - [ ] Verify enemy heal vs player heal code paths
- [ ] Fix enemy heal processing (AC: 1, 2, 3)
  - [ ] Ensure enemy heal intents are processed
  - [ ] Verify lifesteal (damage + heal combo) works
  - [ ] Cap healing at maxHp
- [ ] Update UI to reflect enemy healing (AC: 4)
  - [ ] HP bar updates on heal
  - [ ] Optional: green heal number animation
- [ ] Add combat log entry for enemy heals (AC: 5)
- [ ] Add unit tests (AC: 6)

## Dev Notes

### Bug Context
- Greater Demon has two heal moves:
  - Phase 1: "Consume Minion" - destroys an Imp, heals 20 HP
  - Phase 2: "Soul Harvest" - deals 18 damage, heals 18 HP (lifesteal)
- Neither is functioning, suggesting a general enemy heal bug

### Relevant Files
- `src/engine/CombatEngine.ts` - processEnemyTurn, heal intent handling
- `src/data/enemies/act3-elites.ts` - Greater Demon definition
- `src/ui/renderer.ts` - HP bar rendering

### Testing
- Test file: `src/engine/CombatEngine.test.ts`
- Add tests for: `should heal enemy when heal intent is executed`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-04 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

_To be filled by Dev agent_

---

## QA Results

_To be filled by QA agent_
