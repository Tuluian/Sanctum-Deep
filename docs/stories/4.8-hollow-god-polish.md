# Story 4.8: Hollow God Polish & Narrative Features

## Status: Approved

## Story

**As a** player defeating the Hollow God,
**I want** polished visual effects, audio, and narrative payoff,
**so that** the final boss feels like a true climactic conclusion.

---

## Background

This story covers deferred features from Story 4.6 (Hollow God implementation). The core combat mechanics are complete; this story focuses on polish, narrative, and the post-boss experience.

---

## Acceptance Criteria

1. Warden Choice narrative sequence triggers after defeating Hollow God
2. Audio effects for Chomp mechanic
3. Progressive UI corruption during fight
4. Corrupted cards can be cleansed at shrines
5. Draw penalty at 5+ corrupted cards
6. Massive boss health bar with phase markers
7. Void aesthetic spreads from boss during fight
8. Shadow Self has inverse color player sprite
9. Dramatic visual effect for Forget attack
10. Timer pauses during animations/card resolution
11. Victory/ending sequences based on player choice
12. Boss rewards and run statistics

## Tasks / Subtasks

- [ ] Implement Warden Choice (AC: 1, 11)
  - [ ] Victory triggers narrative sequence
  - [ ] Current Warden appears with dialogue
  - [ ] **Option A: Become the Warden** - Standard ending
  - [ ] **Option B: Destroy the Seal** - Only after all 5 classes beaten
  - [ ] Epilogue screens for each choice
  - [ ] Track which classes have beaten the game

- [ ] Add audio effects (AC: 2)
  - [ ] Chomp sound effect
  - [ ] Screen shake on Chomp
  - [ ] Void ambient sound during fight
  - [ ] Phase transition sounds
  - [ ] Victory fanfare

- [ ] Implement progressive UI corruption (AC: 3)
  - [ ] Phase 1: Card names flicker occasionally
  - [ ] Phase 2: Card names blur/swap letters
  - [ ] Phase 3: Cards nearly unreadable, reality cracks at screen edges
  - [ ] Player portrait corrupts progressively

- [ ] Implement shrine cleansing (AC: 4)
  - [ ] Add "Cleanse Corruption" option at shrines
  - [ ] Remove corrupted status from all cards
  - [ ] Cost: Skip other shrine benefits

- [ ] Implement corruption draw penalty (AC: 5)
  - [ ] Track corruption count in deck
  - [ ] At 5+ corrupted cards, draw 1 fewer card per turn
  - [ ] Display warning indicator

- [ ] Create boss health bar UI (AC: 6)
  - [ ] Large health bar spanning screen width
  - [ ] Phase markers at 70% and 32%
  - [ ] Visual change when crossing phase thresholds
  - [ ] Boss name and phase name display

- [ ] Implement void aesthetic (AC: 7)
  - [ ] Darkness spreads from boss position
  - [ ] Screen edges darken in later phases
  - [ ] Color desaturation effect
  - [ ] Particle effects for void

- [ ] Create Shadow Self sprite (AC: 8)
  - [ ] Generate inverse color version of player class sprite
  - [ ] Glitch/flicker animation
  - [ ] Distinct from regular enemies

- [ ] Add Forget visual effect (AC: 9)
  - [ ] Card dissolves/fades animation
  - [ ] Memory fragment particles
  - [ ] Dramatic pause during effect
  - [ ] Sound effect

- [ ] Timer pause system (AC: 10)
  - [ ] Pause Chomp Timer during card animations
  - [ ] Resume after effect completes
  - [ ] Track animation state

- [ ] Implement boss rewards (AC: 12)
  - [ ] No card reward (narrative conclusion)
  - [ ] Victory unlocks character epilogue
  - [ ] Warden card back cosmetic unlock
  - [ ] Run statistics screen

## Dev Notes

### Warden Choice Implementation
```typescript
function onHollowGodDefeated(): void {
  showNarrativeSequence([
    { speaker: 'narrator', text: 'The void recedes. Silence falls.' },
    { speaker: 'warden', text: 'It is done. The seal holds... for now.' },
    { speaker: 'warden', text: 'Now... the choice.' },
  ]);

  const canDestroySeal = hasBeatenWithAllClasses();

  showChoice({
    title: 'The Final Choice',
    options: [
      {
        id: 'become_warden',
        label: 'Become the Warden',
        description: 'Take up the mantle. Guard the Sanctum for eternity.',
        always_available: true,
      },
      {
        id: 'destroy_seal',
        label: 'Destroy the Seal',
        description: 'End the cycle. Face the consequences together.',
        available: canDestroySeal,
        lockedMessage: 'Prove yourself with all five souls first.',
      },
    ],
  });
}
```

### UI Corruption Levels
```typescript
enum CorruptionLevel {
  NONE = 0,      // Normal display
  WHISPERS = 1,  // Occasional flickers
  CONSUMING = 2, // Blur, letter swaps
  ANNIHILATION = 3, // Nearly unreadable
}

function getCorruptionLevel(bossPhase: number): CorruptionLevel {
  return bossPhase as CorruptionLevel;
}
```

### Shrine Cleansing
```typescript
interface ShrineOption {
  id: string;
  name: string;
  description: string;
  effect: () => void;
}

const CLEANSE_CORRUPTION: ShrineOption = {
  id: 'cleanse_corruption',
  name: 'Cleanse Corruption',
  description: 'Remove corruption from all cards in your deck.',
  effect: () => {
    gameState.corruptedCardIds.clear();
    addLog('The shrine\'s light purifies your corrupted memories.');
  },
};
```

## Testing

### Key Test Scenarios
1. Warden Choice appears after Hollow God defeat
2. Both choice options work correctly
3. Shrine cleansing removes all corruption
4. Draw penalty applies at 5+ corrupted cards
5. UI corruption matches boss phase
6. Timer pauses correctly during animations
7. Shadow Self has correct visual appearance

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-04 | 1.0 | Initial story creation (deferred from 4.6) | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
