# Story 7.1: Combat Juice & Feedback Enhancement

## Status: Draft

## Story

**As a** player,
**I want** satisfying visual and audio feedback for every action,
**so that** combat feels impactful, responsive, and rewarding.

## Problem Statement

The current combat UI has functional feedback but lacks the "juice" that makes actions feel viscerally satisfying. Players report that attacks feel "floaty," card plays lack punch, and victories don't feel earned. This story addresses the gap between functional UI and emotionally engaging UI.

## Acceptance Criteria

1. Card play has satisfying animation with sound effect
2. Damage numbers appear as floating text with impact feel
3. Screen shake on significant hits (configurable)
4. Enemy death has dramatic animation sequence
5. Player hit feedback is visceral but not disorienting
6. Status effect application has distinct visual cue
7. Turn transitions feel smooth and intentional
8. Victory/defeat moments are emotionally impactful

## UX Research Insights

### What Makes Combat "Feel Good"

From analyzing successful deck-builders (Slay the Spire, Monster Train, Inscryption):

1. **Anticipation**: Brief pause before impact
2. **Impact**: Visual punch at moment of connection
3. **Follow-through**: Lingering effects that reinforce action
4. **Audio sync**: Sound precisely timed to visual

### Current Pain Points

- Cards disappear instantly (no "throw" animation)
- Damage appears but doesn't "pop"
- No camera/screen response to big hits
- Enemy death is anticlimactic
- Status effects silently appear

## Tasks / Subtasks

### Card Play Animation (AC: 1)

- [ ] Add card "lift and throw" animation to target
  - [ ] Card scales up 110% on play initiation
  - [ ] Card arcs toward target enemy
  - [ ] Trail effect follows card path (optional)
  - [ ] Card fades at impact point
- [ ] Implement card glow effect for different types
  - [ ] Attack cards: Red pulse glow
  - [ ] Skill cards: Blue ripple effect
  - [ ] Power cards: Purple aura burst
- [ ] Add card play sound effects
  - [ ] Generic card swoosh
  - [ ] Attack impact thud
  - [ ] Skill activation chime
  - [ ] Power activation hum

### Damage Numbers (AC: 2)

- [ ] Create floating damage text system
  - [ ] Number spawns at impact point
  - [ ] Animates upward with slight random X drift
  - [ ] Scales: starts at 80%, peaks at 120%, ends at 100%
  - [ ] Fades out over 0.8s
- [ ] Color-code damage types
  - [ ] Normal damage: White
  - [ ] Blocked damage: Blue with shield icon
  - [ ] Bonus damage (buffs): Green with glow
  - [ ] Overkill: Red with flames
  - [ ] Healing: Green with + prefix
- [ ] Size scales with damage amount
  - [ ] 1-5: Small (1em)
  - [ ] 6-15: Medium (1.3em)
  - [ ] 16+: Large (1.6em) with shake
- [ ] Critical hits get special treatment
  - [ ] "CRIT!" prefix
  - [ ] Screen flash
  - [ ] Larger scale animation

### Screen Shake (AC: 3)

- [ ] Implement configurable screen shake system
  - [ ] Create ShakeService with intensity/duration params
  - [ ] Hook into Settings screen shake toggle
  - [ ] Use CSS transform on container (not viewport)
- [ ] Trigger conditions
  - [ ] Player takes damage: Light shake (2px, 0.2s)
  - [ ] Player takes heavy damage (>15): Medium shake (4px, 0.3s)
  - [ ] Enemy dies: Sharp shake (3px, 0.15s)
  - [ ] Boss phase transition: Heavy shake (6px, 0.5s)
  - [ ] Player defeat: Sustained shake (5px, 1s)
- [ ] Reduced motion support
  - [ ] Respect prefers-reduced-motion media query
  - [ ] Provide toggle in accessibility settings

### Enemy Death Animation (AC: 4)

- [ ] Design multi-stage death sequence
  - [ ] Stage 1: Hit stagger (0.1s) - enemy lurches back
  - [ ] Stage 2: Freeze frame (0.3s) - dramatic pause
  - [ ] Stage 3: Fade + shrink (0.4s) - enemy dissolves
  - [ ] Stage 4: Particle burst - soul essence effect
- [ ] Add death sound effect
  - [ ] Generic enemy death cry
  - [ ] Elite special death sound
  - [ ] Boss dramatic death sound
- [ ] Victory XP/rewards particles flow toward player
- [ ] Dead enemy slot shows grave marker briefly

### Player Hit Feedback (AC: 5)

- [ ] Red vignette flash on damage
  - [ ] Intensity scales with damage percentage
  - [ ] Duration: 0.15s fade in, 0.3s fade out
- [ ] Player silhouette staggers
  - [ ] Translate X -10px briefly
  - [ ] Slight rotate (-3deg)
- [ ] HP bar animation
  - [ ] Delayed drain effect (current HP depletes, then max follows)
  - [ ] Low HP pulse intensifies
- [ ] Audio feedback
  - [ ] Player grunt/hit sound
  - [ ] Armor clang if blocked

### Status Effect Application (AC: 6)

- [ ] Status icon "pops" into existence
  - [ ] Scale from 0% to 120% to 100%
  - [ ] Brief glow matching buff/debuff color
- [ ] Stack increase animation
  - [ ] Number bounces up
  - [ ] Brief highlight
- [ ] Status about to expire warning
  - [ ] Icon pulses when 1 stack/turn remaining
  - [ ] Dimming effect

### Turn Transitions (AC: 7)

- [ ] "Your Turn" / "Enemy Turn" banner
  - [ ] Slides in from side
  - [ ] Brief display (0.8s)
  - [ ] Slides out opposite direction
- [ ] End turn button feedback
  - [ ] Satisfying click animation
  - [ ] Brief disabled state during transition
- [ ] Enemy intent reveal animation
  - [ ] Icons fade in sequentially
  - [ ] Slight delay between enemies (0.1s each)

### Victory/Defeat Moments (AC: 8)

- [ ] Victory sequence
  - [ ] Time slow effect on final blow
  - [ ] Screen flash white
  - [ ] Triumphant fanfare
  - [ ] Particle celebration effect
  - [ ] Stats roll up animation
- [ ] Defeat sequence
  - [ ] Screen desaturates
  - [ ] Player silhouette falls
  - [ ] Somber music transition
  - [ ] "You have fallen..." text fades in
  - [ ] Reflective pause before restart option

## Dev Notes

### Animation Timing Reference

```css
:root {
  --anim-instant: 0.1s;
  --anim-fast: 0.2s;
  --anim-normal: 0.3s;
  --anim-slow: 0.5s;
  --anim-dramatic: 0.8s;

  /* Easing */
  --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
```

### Floating Damage Text Component

```typescript
interface DamageNumber {
  value: number;
  type: 'damage' | 'block' | 'heal' | 'bonus' | 'crit';
  position: { x: number; y: number };
}

class DamageNumberSystem {
  spawn(config: DamageNumber): void {
    const el = document.createElement('div');
    el.className = `damage-number ${config.type}`;
    el.textContent = this.formatValue(config);
    el.style.left = `${config.position.x}px`;
    el.style.top = `${config.position.y}px`;

    this.container.appendChild(el);

    // Trigger animation
    requestAnimationFrame(() => {
      el.classList.add('animate');
    });

    // Cleanup
    setTimeout(() => el.remove(), 1000);
  }
}
```

### Screen Shake Implementation

```typescript
class ShakeService {
  private container: HTMLElement;

  shake(intensity: number, duration: number): void {
    if (!this.isEnabled()) return;

    const keyframes = this.generateShakeKeyframes(intensity);
    this.container.animate(keyframes, {
      duration,
      easing: 'ease-out'
    });
  }

  private generateShakeKeyframes(intensity: number): Keyframe[] {
    return [
      { transform: 'translate(0, 0)' },
      { transform: `translate(${intensity}px, ${intensity/2}px)` },
      { transform: `translate(-${intensity}px, -${intensity/2}px)` },
      { transform: `translate(${intensity/2}px, -${intensity}px)` },
      { transform: 'translate(0, 0)' }
    ];
  }
}
```

### Audio Integration Points

| Event | Sound | Priority |
|-------|-------|----------|
| Card played | card_swoosh.ogg | High |
| Attack hits | impact_hit.ogg | High |
| Block absorbs | shield_clang.ogg | High |
| Enemy dies | enemy_death.ogg | High |
| Player hit | player_hurt.ogg | High |
| Status applied | status_apply.ogg | Medium |
| Turn start | turn_chime.ogg | Low |
| Victory | victory_fanfare.ogg | High |
| Defeat | defeat_somber.ogg | High |

## Design Mockups

### Damage Number Styles

```
Normal:    "12"        (white, medium)
Blocked:   "üõ°Ô∏è 5"      (blue, small, with icon)
Bonus:     "+8"        (green, glow effect)
Crit:      "CRIT! 24"  (gold, large, shake)
Heal:      "+15"       (green, hearts particle)
```

### Enemy Death Sequence

```
Frame 1: [Enemy staggers back]     0.0s
Frame 2: [Freeze - dramatic pause] 0.1s
Frame 3: [Flash white]             0.4s
Frame 4: [Fade + shrink]           0.4s
Frame 5: [Particle burst]          0.8s
Frame 6: [Slot empty]              1.0s
```

## Testing

### Test Scenarios

1. Play attack card - verify animation + damage number
2. Take damage - verify screen shake + red vignette
3. Kill enemy - verify death sequence completes
4. Win combat - verify victory celebration
5. Lose combat - verify defeat sequence
6. Toggle screen shake off - verify no shake occurs
7. Play with reduced motion - verify alternatives

### Performance Targets

- Animation frame rate: 60fps minimum
- No layout thrashing during animations
- Memory cleanup after particle effects
- Total animation memory < 10MB

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-04 | 1.0 | Initial story creation | Sally (UX) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
