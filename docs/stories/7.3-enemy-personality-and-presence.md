# Story 7.3: Enemy Personality & Presence

## Status: Draft

## Story

**As a** player,
**I want** enemies to feel like distinct, living threats,
**so that** combat feels like a battle against memorable foes rather than HP bars to deplete.

## Problem Statement

Current enemies are functional silhouettes with statsâ€”they lack personality, threat presence, and memorable identity. Players should feel tension when a boss charges an attack, relief when a nuisance enemy dies, and dread when facing certain enemy combinations.

## Acceptance Criteria

1. Each enemy type has distinct idle animation
2. Enemies telegraph attacks with warning animations
3. Intent icons are animated and attention-grabbing
4. Boss enemies have enhanced presence (size, effects)
5. Enemy status changes have visual feedback
6. Multi-enemy encounters show group dynamics
7. Enemy intro animations for new encounters
8. Elite enemies have distinguishing visual markers

## UX Research: Enemy Design Psychology

### Threat Hierarchy Communication

Players should instantly understand:
1. **Boss** - Dominant threat, central focus
2. **Elite** - Elevated threat, requires strategy
3. **Minion** - Supporting threat, often priority target
4. **Standard** - Base threat level

### Intent Clarity Principles

- Intent should be readable within 0.5 seconds
- Color + icon + number = redundant communication
- Animation draws attention to important intents
- Dangerous intents should feel dangerous

## Tasks / Subtasks

### Idle Animations (AC: 1)

- [ ] Create idle animation system
  - [ ] Subtle breathing/movement loop
  - [ ] 2-4 second cycle
  - [ ] Varies by enemy type
- [ ] Enemy-specific idle behaviors
  - [ ] Cultist: Swaying, chanting motion
  - [ ] Slime: Pulsing, jiggling
  - [ ] Skeleton: Bones rattling, jaw movement
  - [ ] Void enemies: Flickering, unstable
  - [ ] Aquatic enemies: Floating, water dripping
- [ ] CSS animation approach
  ```css
  @keyframes idle-cultist {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-3px) rotate(1deg); }
  }
  ```

### Attack Telegraph (AC: 2)

- [ ] Pre-attack warning phase
  - [ ] Enemy winds up before attack turn
  - [ ] Duration: Last 0.5s of enemy turn
  - [ ] Visual: Enemy leans back/glows
- [ ] Attack-specific telegraphs
  - [ ] Basic attack: Enemy shifts forward
  - [ ] Heavy attack: Enemy glows red, shakes
  - [ ] Multi-hit: Rapid vibration
  - [ ] Defend: Defensive posture
  - [ ] Buff: Glowing aura
  - [ ] Summon: Magical circles appear
- [ ] Charging attacks (multi-turn)
  - [ ] Obvious power accumulation visual
  - [ ] Intensity increases each turn
  - [ ] "!" warning indicator

### Animated Intents (AC: 3)

- [ ] Intent icon animations
  - [ ] Attack: Sword pulses/shakes
  - [ ] Defend: Shield spins into place
  - [ ] Buff: Stars spiral
  - [ ] Debuff: Skull fades in ominously
  - [ ] Unknown: Question mark bounces
- [ ] Damage number emphasis
  - [ ] High damage (15+): Number shakes, red glow
  - [ ] Multi-hit: Shows "Xx N" with rapid blinks
- [ ] Intent change animation
  - [ ] Old intent fades/slides out
  - [ ] New intent appears with emphasis

### Boss Presence (AC: 4)

- [ ] Enhanced visual scale
  - [ ] Boss figure 1.5x larger than standard
  - [ ] Occupies more vertical space
  - [ ] Other enemies slightly pushed aside
- [ ] Atmospheric effects
  - [ ] Subtle screen darkening around boss
  - [ ] Particle effects (floating embers, shadows)
  - [ ] Ground impact effect
- [ ] Boss-specific elements
  - [ ] Bonelord: Bone fragments orbit
  - [ ] Drowned King: Water drips, bubbles rise
  - [ ] Hollow God: Reality distortion, glitches
- [ ] Phase transition presentation
  - [ ] Screen shake
  - [ ] Boss roars/poses
  - [ ] Music intensity change
  - [ ] New ability showcase

### Status Change Feedback (AC: 5)

- [ ] When enemy gains buff
  - [ ] Upward sparkle effect
  - [ ] Brief positive glow
  - [ ] Sound: Power-up chime
- [ ] When enemy gains block
  - [ ] Shield materializes around enemy
  - [ ] Sound: Metal clang
- [ ] When enemy takes debuff
  - [ ] Negative effect particles
  - [ ] Enemy staggers slightly
  - [ ] Sound: Debilitation sound
- [ ] When block breaks
  - [ ] Shield shatters
  - [ ] Sound: Glass break
- [ ] When enemy heals
  - [ ] Green glow
  - [ ] Ascending plus symbols

### Group Dynamics (AC: 6)

- [ ] Enemy positioning intelligence
  - [ ] Ranged enemies stand back
  - [ ] Support enemies near boss
  - [ ] Minions cluster
- [ ] Group reactions
  - [ ] When ally dies: Others react (flinch, enrage)
  - [ ] When buffed: Acknowledges buffer
  - [ ] Formation shifts as enemies die
- [ ] Coordinated attacks visual
  - [ ] Multiple enemies attacking together
  - [ ] Synchronized animation timing

### Intro Animations (AC: 7)

- [ ] Combat start presentation
  - [ ] Enemies enter from sides/above
  - [ ] Staggered appearance (0.2s apart)
  - [ ] Landing/arrival animation
- [ ] Boss intro sequence
  - [ ] Extended dramatic entrance
  - [ ] Music cue
  - [ ] Name card display
  - [ ] Phase 1 ability preview
- [ ] Elite intro
  - [ ] Brief menacing pose
  - [ ] "Elite" marker flash

### Elite Visual Markers (AC: 8)

- [ ] Distinguishing elements
  - [ ] Glowing border/outline (gold or red)
  - [ ] "Elite" badge near name
  - [ ] Slightly larger than standard
- [ ] Enhanced details
  - [ ] Additional visual flourishes
  - [ ] More active idle animation
  - [ ] Particle effects (sparks, wisps)
- [ ] HP bar distinction
  - [ ] Different border style
  - [ ] Larger font
  - [ ] Sub-bar for phases (if applicable)

## Dev Notes

### Enemy Figure System Enhancement

```typescript
interface EnemyVisuals {
  id: string;
  baseClass: string;
  idleAnimation: string;
  attackAnimation: string;
  hitAnimation: string;
  deathAnimation: string;
  specialEffects: {
    particles?: ParticleConfig;
    glow?: GlowConfig;
    distortion?: DistortionConfig;
  };
}

const ENEMY_VISUALS: Record<string, EnemyVisuals> = {
  cultist: {
    id: 'cultist',
    baseClass: 'enemy-humanoid',
    idleAnimation: 'idle-cultist',
    attackAnimation: 'attack-slash',
    hitAnimation: 'hit-stagger',
    deathAnimation: 'death-collapse',
    specialEffects: {}
  },
  bonelord: {
    id: 'bonelord',
    baseClass: 'enemy-boss',
    idleAnimation: 'idle-bonelord',
    attackAnimation: 'attack-boss',
    hitAnimation: 'hit-boss',
    deathAnimation: 'death-boss',
    specialEffects: {
      particles: {
        type: 'bone-fragments',
        count: 8,
        orbit: true
      },
      glow: {
        color: '#a855f7',
        intensity: 0.3
      }
    }
  }
};
```

### Intent Animation CSS

```css
/* Base intent animations */
.intent-icon {
  animation: intent-idle 2s ease-in-out infinite;
}

@keyframes intent-idle {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* Attack intent - more aggressive */
.intent-attack .intent-icon {
  animation: intent-attack 0.5s ease-in-out infinite;
}

@keyframes intent-attack {
  0%, 100% { transform: translateX(0) rotate(0deg); }
  25% { transform: translateX(2px) rotate(2deg); }
  75% { transform: translateX(-2px) rotate(-2deg); }
}

/* High damage emphasis */
.intent-attack.high-damage .intent-icon {
  animation: intent-high-damage 0.3s ease-in-out infinite;
  filter: drop-shadow(0 0 10px #ef4444);
}

@keyframes intent-high-damage {
  0%, 100% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.15) rotate(3deg); }
}

/* Charging attack */
.intent-charging .intent-icon {
  animation: intent-charging 0.8s ease-in-out infinite;
}

@keyframes intent-charging {
  0% { transform: scale(1); filter: brightness(1); }
  50% { transform: scale(1.2); filter: brightness(1.3); }
  100% { transform: scale(1); filter: brightness(1); }
}
```

### Boss Phase Transition System

```typescript
async function handleBossPhaseTransition(
  boss: Enemy,
  newPhase: number
): Promise<void> {
  // 1. Pause combat
  combatPaused = true;

  // 2. Dramatic pause
  await sleep(500);

  // 3. Boss transformation animation
  const bossEl = document.querySelector(`[data-enemy-id="${boss.id}"]`);
  bossEl.classList.add('phase-transition');

  // 4. Screen effects
  shakeScreen(6, 500);
  flashScreen('#ffffff', 0.3);

  // 5. Phase announcement
  showPhaseAnnouncement(boss.name, newPhase);

  // 6. Music transition
  AudioManager.transitionToTrack(`boss_phase_${newPhase}`);

  // 7. Wait for animation
  await sleep(1500);

  // 8. Resume
  bossEl.classList.remove('phase-transition');
  bossEl.classList.add(`phase-${newPhase}`);
  combatPaused = false;
}
```

### Enemy Entry Animation

```css
/* Standard enemy entry */
.enemy.entering {
  animation: enemy-enter 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes enemy-enter {
  0% {
    opacity: 0;
    transform: translateY(-30px) scale(0.8);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Boss entry - more dramatic */
.enemy.boss.entering {
  animation: boss-enter 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes boss-enter {
  0% {
    opacity: 0;
    transform: translateY(-100px) scale(0.5);
    filter: brightness(2);
  }
  50% {
    opacity: 1;
    transform: translateY(20px) scale(1.1);
    filter: brightness(1.5);
  }
  70% {
    transform: translateY(-10px) scale(1.05);
  }
  100% {
    transform: translateY(0) scale(1);
    filter: brightness(1);
  }
}
```

## Visual Reference

### Threat Hierarchy Sizing

```
Standard Enemy:  [  60px height  ]
Elite Enemy:     [   75px height   ] + gold border
Boss Enemy:      [     100px height     ] + effects + crown
```

### Intent Urgency Indicators

```
Low threat:    White icon, gentle pulse
Medium threat: Yellow icon, moderate shake
High threat:   Red icon, aggressive shake + glow
Charging:      Purple icon, building intensity
```

## Testing

### Test Scenarios

1. View each enemy type idle animation
2. Observe attack telegraph before damage
3. Intent icons animate appropriately
4. Boss has enhanced presence and effects
5. Status changes show feedback
6. Multi-enemy reactions to ally death
7. Combat start shows enemy entries
8. Elite markers are visible and distinct

### Performance Targets

- Particle effects < 50 particles per enemy
- Idle animations use CSS (not JS)
- No frame drops during boss phases
- Total enemy animation memory < 5MB

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-04 | 1.0 | Initial story creation | Sally (UX) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
