# Story 13.1: Capacitor Setup & Configuration

## Status: Draft

## Story

**As a** developer preparing for iOS deployment,
**I want** Capacitor properly configured in the project,
**so that** the web app can be wrapped as a native iOS application.

## Acceptance Criteria

1. Capacitor Core installed and configured
2. iOS platform added to project
3. `capacitor.config.ts` properly configured with app ID and name
4. Xcode project generated and buildable
5. Web assets copy to iOS build correctly
6. App launches in iOS Simulator - 'Expo Go'
7. Live reload works during development
8. All existing web functionality works in Capacitor webview

## Background

From brief.md:
- "Target Platforms (Post-MVP): iOS App Store via Capacitor wrapper"
- "Mobile Strategy: Capacitor wrapper for iOS with native API access (haptics, IAP, push)"

Capacitor is Ionic's native runtime that wraps web apps into native mobile applications. It provides:
- Native API access via plugins
- Full App Store compatibility
- TypeScript-first plugin development
- Seamless web-to-native bridge

## Tasks / Subtasks

- [ ] Install Capacitor dependencies (AC: 1)
  - [ ] `npm install @capacitor/core @capacitor/cli`
  - [ ] `npm install @capacitor/ios`
  - [ ] Initialize with `npx cap init`
- [ ] Configure Capacitor (AC: 2, 3)
  - [ ] Set appId (e.g., `com.sanctumruins.game`)
  - [ ] Set appName: "Sanctum Ruins"
  - [ ] Configure webDir to point to build output
  - [ ] Set server config for development
- [ ] Add iOS platform (AC: 2, 4)
  - [ ] Run `npx cap add ios`
  - [ ] Verify Xcode project created in `ios/` folder
- [ ] Build and sync (AC: 5)
  - [ ] Run production build `npm run build`
  - [ ] Sync with `npx cap sync ios`
  - [ ] Verify assets copied correctly
- [ ] Test in Simulator (AC: 6, 8)
  - [ ] Open project `npx cap open ios`
  - [ ] Run in iPhone Simulator
  - [ ] Verify game loads and plays correctly
- [ ] Configure live reload (AC: 7)
  - [ ] Set up Capacitor live reload for dev
  - [ ] Document development workflow
- [ ] Update package.json scripts (AC: all)
  - [ ] Add `ios:sync`, `ios:open`, `ios:dev` scripts

## Dev Notes

### Required Prerequisites
- macOS with Xcode 14+ installed
- Xcode Command Line Tools
- CocoaPods (for native dependencies)
- Apple Developer Account (for device testing/submission)

### Capacitor Config Example

```typescript
// capacitor.config.ts
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.sanctumruins.game',
  appName: 'Sanctum Ruins',
  webDir: 'dist',
  server: {
    androidScheme: 'https',
    iosScheme: 'https'
  },
  ios: {
    contentInset: 'automatic',
    preferredContentMode: 'mobile'
  }
};

export default config;
```

### Package.json Script Additions

```json
{
  "scripts": {
    "ios:build": "npm run build && npx cap sync ios",
    "ios:open": "npx cap open ios",
    "ios:dev": "npx cap run ios --livereload --external"
  }
}
```

### Webview Considerations
- Capacitor uses WKWebView on iOS
- Full ES6+ support in modern iOS versions
- Local storage works within the app sandbox
- Touch events map correctly from web

### Relevant Files
- `capacitor.config.ts` (new)
- `package.json` - add scripts and dependencies
- `ios/` - generated Xcode project folder

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-04 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

_To be filled by Dev agent_

---

## QA Results

_To be filled by QA agent_
