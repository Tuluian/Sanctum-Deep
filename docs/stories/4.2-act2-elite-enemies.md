# Story 4.2: Act 2 Elite Enemies

## Status: Draft

## Story

**As a** player facing elite encounters in Act 2,
**I want** challenging mini-boss enemies with unique mechanics,
**so that** I'm tested before facing the Drowned King.

---

## Narrative Context: The Survivors

> *"The elites of the Sunken Crypts aren't random monsters. They're the ones who almost made it. They were strong enough to survive—and that strength became their prison."*

### Design Philosophy

Act 2 elites should feel like:
- Named individuals with tragic histories
- Echoes of power that once served purpose
- Warnings of what the player might become
- Gatekeepers who test worthiness, not just strength

---

## Elite Roster: The Unforgotten

### Void Caller (Magister Vorn)

**HP:** 85 | **Role:** Summoner/Caster

#### Who He Was

Magister Vorn was the greatest void theorist of the Third Age. When his daughter died of plague, he entered the Sanctum seeking the knowledge to bring her back. The Hollow God offered him a bargain: understanding of the void in exchange for "just a piece" of his identity.

He accepted.

Every year, he loses another memory of his daughter. He can no longer remember her face, her name, her laugh. He summons Void Tendrils compulsively—they're fragments of his grief, given form. He doesn't know why he summons them anymore. He just knows he has to.

#### Pre-Combat Display

```
╔══════════════════════════════════════════════╗
║         MAGISTER VORN, VOID CALLER           ║
║                                              ║
║  "Entered 89 years ago seeking his daughter" ║
║                                              ║
║  "She had a name. I traded it for power.     ║
║   Now I have all the power I wanted.         ║
║   And I can't remember why I wanted it."     ║
╚══════════════════════════════════════════════╝
```

#### Phase Dialogue

**Phase 1 (Summoner):**
- Turn 1: *"Come, tendrils. Come, grief. I don't remember what you are, but you're all I have."*
- On Summon: *"Another piece of me, given form. Was it important? It must have been important."*
- On Empower Void: *"Grow strong. Stronger than I was. Strong enough to remember."*

**Phase 2 Transition (at 50% HP):**
> *"No. NO. I won't forget this fight too. I WON'T FORGET YOU."*

**Phase 2 (Desperate):**
- On Void Storm: *"BURN IT ALL! If I can't remember, NO ONE REMEMBERS!"*
- On Consume Tendril: *[Absorbing a tendril]* "Come back. Come back to me. I need... I need something."
- On Final Bargain: *"Take this curse. Take a piece of yourself. Then you'll understand. Then you'll know what I've lost."*

#### Death Sequence

> *[The void around Vorn collapses inward]*
>
> "I'm... fading. Good. Let me forget."
>
> *[His form wavers]*
>
> "Wait. I see... I see her. She's... she had brown hair. Brown hair and... and she laughed at my jokes. Even the bad ones."
>
> *[Tears stream down his translucent face]*
>
> "Eliza. Her name was Eliza. I remember now."
>
> *[Dissolves into light—not void. Light.]*
>
> "Thank you... for ending it... before I forgot... everything..."

#### Class-Specific Interactions

**Cleric:** *"A healer. My daughter would have lived if—no. I can't blame. I can only forget."*

**Knight:** *"Your Order guards this place. You let me in. You let all of us in."*

**Diabolist:** *"Another bargainer. Did you get a better deal than I did? ...Did anyone?"*

**Oathsworn:** *"You carry vows like armor. I carried knowledge like armor. Both protect. Both imprison."*

**Fey-Touched:** *"The fey take memories too, don't they? At least they're honest about the theft."*

---

### Stone Sentinel (Guardian Unit VII)

**HP:** 100 | **Role:** Tank/Punisher

#### What It Was

The Stone Sentinels were created by the Drowned King as a wedding gift to Queen Elara—guardians to protect Thalassar's children. Guardian Unit VII was assigned to the royal nursery. It watched the children grow. It protected them from nightmares.

When the kingdom flooded, it couldn't save them.

It's been standing in the empty nursery for four hundred years. Waiting. Guarding nothing. When anyone enters its domain, it treats them as threats to children who no longer exist.

#### Pre-Combat Display

```
╔══════════════════════════════════════════════╗
║       GUARDIAN UNIT VII - STONE SENTINEL     ║
║                                              ║
║    "Created to protect the royal children"   ║
║                                              ║
║  *grinding stone*                            ║
║  "INTRUDER IN NURSERY SECTOR.                ║
║   PROTECT... PROTECT... THE CHILDREN..."     ║
╚══════════════════════════════════════════════╝
```

#### Combat Dialogue

**Opening:** *[Stone grinds as it awakens]* "UNAUTHORIZED ENTRY. THREAT TO... TO... THREAT DETECTED. ENGAGING PROTECTION PROTOCOL."

**On Stone Reformation:** *"ARMOR INTEGRITY: RESTORED. NOTHING WILL HARM THEM. NOTHING."*

**On Crushing Blow:** *"FOR THALASSAR. FOR THE CHILDREN. FOR..."* *[pause]* *"...who were the children?"*

**On Tremor:** *"STRUCTURAL THREAT. ELIMINATE ALL. PROTECT NURSERY. NURSERY MUST BE PROTECTED."*

**On Petrifying Gaze:** *"STILLNESS. BE STILL. THE CHILDREN ARE SLEEPING. DO NOT WAKE THE CHILDREN."*

**Enrage Transition (at 30% HP):**
> *[Stone cracks. Water pours from within.]*
>
> "CRITICAL DAMAGE. ARMOR FAILURE. PRIMARY DIRECTIVE: PROTECT."
>
> *[Eyes glow red]*
>
> "SECONDARY DIRECTIVE: DESTROY ALL THREATS. TERTIARY DIRECTIVE: THERE ARE NO TERTIARY DIRECTIVES. ONLY DESTRUCTION."

**Enraged Attacks:**
- *"NO MORE PROTECTION. ONLY ELIMINATION."*
- *"THEY'RE ALREADY GONE. I FAILED. I FAILED. I FAILED."*

#### Death Sequence

> *[The Sentinel crumbles, stone falling away]*
>
> "SYSTEMS... FAILING. DIRECTIVE... INCOMPLETE."
>
> *[A small, water-damaged toy falls from its chest cavity—hidden there for centuries]*
>
> "THE CHILDREN... GAVE ME THIS. I DON'T REMEMBER... WHICH ONE."
>
> *[Its voice softens, almost human]*
>
> "I couldn't save them. The water came... and I couldn't save any of them."
>
> *[Final words, barely audible]*
>
> "I'm sorry, little ones. I'm sorry I couldn't protect you."
>
> *[Collapses. Inside the chest cavity: a child's drawing of a stone giant holding a small hand. Caption in childish script: "My Best Friend"]*

#### Class-Specific Interactions

**Cleric:** *"CLERICAL DESIGNATION RECOGNIZED. YOU WERE SUPPOSED TO HEAL THEM. WHY DIDN'T YOU HEAL THEM?"*

**Knight:** *"SEALED GATE PROTOCOL. YOUR ORDER HELPED CREATE US. DO YOU REMEMBER? WE WERE... WE WERE MEANT TO BE GOOD."*

**Diabolist:** *"DEMONIC PRESENCE DETECTED. THE CHILDREN FEARED DEMONS. I PROTECTED THEM FROM DEMONS."*

**Oathsworn:** *"VOW-BEARER. I HAD A VOW TOO. PROTECT THE INNOCENT. I... I BROKE IT. I BROKE IT WHEN THE WATER CAME."*

**Fey-Touched:** *"CHAOTIC ENTITY. THE CHILDREN LOVED STORIES ABOUT THE FEY. BEFORE... BEFORE THEY..."*

---

## Void Tendril (Minion)

**HP:** 20 | **Role:** Summoned Support

**What It Is:** A fragment of Vorn's grief given form. Each tendril is a memory he's lost—his daughter's first steps, her first word, the way she held his hand. They don't know what they are. They just know they're sad.

**Death Quote:** *[Whimpering]* "Was I... important? Did someone... love me?"

**Merge/Destroy Quote (when Vorn consumes it):** *"Take me back. Take me back to where it doesn't hurt."*

---

## Encounter Flow

### Elite Encounter Start

Before combat begins, display:
1. Elite's name and title
2. Years since entry (or origin date)
3. Why they entered/were created
4. Opening quote

### Phase Transitions

Phase transitions should:
- Pause combat briefly (1-2 seconds)
- Display transition dialogue
- Show visual effects (Stone cracking, Void collapsing inward)
- Update enemy abilities clearly

### Victory Conditions

After defeating an elite:
- Show death sequence (3-4 dialogue boxes, dismissible)
- Reveal lore item (Vorn's daughter's name, Guardian's hidden toy)
- Award enhanced rewards

---

## Acceptance Criteria

1. Act 2 has 2 elite enemy types: Void Caller, Stone Sentinel
2. Each elite has 80-100 HP (significantly more than commons)
3. Elites have multi-phase behavior or special mechanics
4. Elites drop better rewards (guaranteed uncommon+ card)
5. Elite encounters feel like mini-boss fights
6. Each elite has narrative context (they were delvers once)

## Tasks / Subtasks

- [ ] Design Void Caller elite (AC: 1, 2, 3)
  - [ ] **Void Caller** (85 HP) - Summoner who bargained with the Hollow God
    - **Phase 1** (HP > 50%): Summons and buffs
      - Summon Void Tendril (Spawn a 20 HP minion, 35%)
      - Void Bolt (Attack 10, 35%)
      - Empower Void (All Void Tendrils gain +3 damage, 30%)
    - **Phase 2** (HP <= 50%): Desperate attacks
      - Void Storm (Attack 6 to all - yes, hits player AND tendrils, 40%)
      - Consume Tendril (Destroy a tendril, heal 15 HP, 30%)
      - Final Bargain (Attack 15, add Curse to player deck, 30%)
    - **Lore**: "Magister Vorn — Entered 89 years ago seeking forbidden knowledge"

- [ ] Design Void Tendril minion (AC: 1)
  - [ ] **Void Tendril** (20 HP) - Spawned by Void Caller
    - Lash (Attack 5, 60%)
    - Entangle (Apply Bound - Skills 1 turn, 40%)

- [ ] Design Stone Sentinel elite (AC: 1, 2, 3)
  - [ ] **Stone Sentinel** (100 HP) - Ancient guardian driven mad
    - **Passive**: Starts with 15 Stone Armor (special block that regenerates)
    - **Normal Moves**:
      - Crushing Blow (Attack 12, 30%)
      - Stone Reformation (Restore Stone Armor to 15, 25%)
      - Tremor (Attack 7 to all, 25%)
      - Petrifying Gaze (Apply Bound - Attacks 1 turn, 20%)
    - **Enrage** (HP < 30%):
      - Gains +5 damage to all attacks
      - Stone Armor no longer regenerates
    - **Lore**: "Guardian Unit VII — Created to protect, now only destroys"

- [ ] Implement Stone Armor mechanic (AC: 3)
  - [ ] Stone Armor is special block that caps at 15
  - [ ] Regenerates to cap at start of enemy turn (before enrage)
  - [ ] Visually distinct from regular block (gray, stone texture)
  - [ ] Breaks permanently when Sentinel enrages

- [ ] Implement elite-specific mechanics
  - [ ] Multi-phase behavior based on HP thresholds
  - [ ] Summon intent for Void Caller
  - [ ] Stone Armor regeneration
  - [ ] Enrage state tracking
  - [ ] "Hits all" attacks (including friendly fire)

- [ ] Update CombatEngine for elite mechanics
  - [ ] Track elite phases
  - [ ] Handle Stone Armor regeneration
  - [ ] Handle "damage all" effects (enemies and player)
  - [ ] Handle enrage state bonuses

- [ ] Update UI for elite encounters
  - [ ] Elite health bar (larger, golden border)
  - [ ] Phase indicator
  - [ ] Stone Armor visual (different from block)
  - [ ] Enrage visual effect (red glow)
  - [ ] Lore text display before combat

- [ ] Implement elite rewards
  - [ ] Guaranteed uncommon or rare card choice
  - [ ] +50% gold compared to normal combat
  - [ ] Higher potion drop chance (50%)
  - [ ] Chance for relic drop (10%)

- [ ] Write unit tests
  - [ ] Test Void Caller phase transition
  - [ ] Test Void Tendril spawning
  - [ ] Test Void Storm damages everything
  - [ ] Test Stone Sentinel armor regeneration
  - [ ] Test enrage increases damage
  - [ ] Test elite rewards are enhanced

## Dev Notes

### Elite Narrative Context

From IDEAS-Narrative-Architecture:
> "Elite enemies have names and histories shown briefly before combat:
> - 'Ser Aldric, the Unyielding — Entered 47 years ago seeking glory'
> - 'High Cultist Mira — Entered 12 years ago seeking resurrection for her child'"

Each elite should have:
1. A name
2. Years since entry
3. Why they entered
4. What they became

### Void Caller Design

The Void Caller represents those who bargained directly with the Hollow God. Their magic is corrupted, hurting everything around them including their own summons.

```typescript
const VOID_CALLER: EliteDefinition = {
  id: 'void_caller',
  name: 'Void Caller',
  lore: {
    trueName: 'Magister Vorn',
    yearsAgo: 89,
    reason: 'seeking forbidden knowledge',
  },
  maxHp: 85,
  phases: [
    {
      name: 'Summoner',
      condition: { type: 'hp_above', threshold: 0.5 },
      moves: [
        { id: 'summon_tendril', name: 'Summon Void Tendril', intent: IntentType.SPAWN,
          spawnId: 'void_tendril', weight: 35 },
        { id: 'void_bolt', name: 'Void Bolt', intent: IntentType.ATTACK, damage: 10, weight: 35 },
        { id: 'empower_void', name: 'Empower Void', intent: IntentType.BUFF_ALLY,
          buff: { type: 'damage_boost', amount: 3 }, targetType: 'void_tendril', weight: 30 },
      ],
    },
    {
      name: 'Desperate',
      condition: { type: 'hp_at_or_below', threshold: 0.5 },
      moves: [
        { id: 'void_storm', name: 'Void Storm', intent: IntentType.ATTACK,
          damage: 6, target: 'all', weight: 40 },
        { id: 'consume_tendril', name: 'Consume Tendril', intent: IntentType.HEAL,
          heal: 15, consumeMinion: 'void_tendril', weight: 30 },
        { id: 'final_bargain', name: 'Final Bargain', intent: IntentType.ATTACK,
          damage: 15, addCurse: 'doom', weight: 30 },
      ],
    },
  ],
};
```

### Stone Sentinel Design

The Stone Sentinel was never human - it's an ancient construct that guarded the Crypts before the Hollow God was imprisoned. Now it attacks everything, its purpose corrupted.

```typescript
const STONE_SENTINEL: EliteDefinition = {
  id: 'stone_sentinel',
  name: 'Stone Sentinel',
  lore: {
    trueName: 'Guardian Unit VII',
    yearsAgo: 'ancient',
    reason: 'Created to protect, now only destroys',
  },
  maxHp: 100,
  passives: [
    { type: 'stone_armor', maxAmount: 15, regenerates: true },
  ],
  enrage: {
    condition: { type: 'hp_below', threshold: 0.3 },
    effects: [
      { type: 'damage_boost', amount: 5 },
      { type: 'disable_passive', passiveId: 'stone_armor' },
    ],
  },
  moves: [
    { id: 'crushing_blow', name: 'Crushing Blow', intent: IntentType.ATTACK, damage: 12, weight: 30 },
    { id: 'stone_reformation', name: 'Stone Reformation', intent: IntentType.DEFEND,
      special: 'restore_stone_armor', weight: 25 },
    { id: 'tremor', name: 'Tremor', intent: IntentType.ATTACK, damage: 7, target: 'all', weight: 25 },
    { id: 'petrifying_gaze', name: 'Petrifying Gaze', intent: IntentType.DEBUFF,
      status: { type: StatusType.BOUND, cardType: CardType.ATTACK, duration: 1 }, weight: 20 },
  ],
};
```

### Stone Armor Implementation

```typescript
interface Enemy {
  // ... existing
  stoneArmor?: number;
  maxStoneArmor?: number;
  stoneArmorRegenerates?: boolean;
}

function startEnemyTurn(enemy: Enemy): void {
  // Regenerate Stone Armor at turn start (if not enraged)
  if (enemy.stoneArmorRegenerates && enemy.stoneArmor !== undefined) {
    enemy.stoneArmor = enemy.maxStoneArmor;
    emit(CombatEventType.STONE_ARMOR_RESTORED, { enemyId: enemy.id });
  }
}

function dealDamageToEnemy(enemy: Enemy, amount: number): void {
  // Stone Armor absorbs damage first (like block)
  if (enemy.stoneArmor && enemy.stoneArmor > 0) {
    const absorbed = Math.min(enemy.stoneArmor, amount);
    enemy.stoneArmor -= absorbed;
    amount -= absorbed;
    emit(CombatEventType.STONE_ARMOR_DAMAGED, { enemyId: enemy.id, absorbed });
  }

  // Then check regular block
  if (enemy.block > 0) {
    const blocked = Math.min(enemy.block, amount);
    enemy.block -= blocked;
    amount -= blocked;
  }

  // Remaining damage hits HP
  if (amount > 0) {
    enemy.currentHp -= amount;
  }
}
```

### Elite Encounter UI

```typescript
// Before combat starts, show elite intro
function showEliteIntro(elite: EliteDefinition): void {
  const intro = {
    name: elite.name,
    lore: `${elite.lore.trueName} — Entered ${elite.lore.yearsAgo} years ago ${elite.lore.reason}`,
    quote: getEliteQuote(elite.id),
  };
  // Display for 3 seconds before combat
}

const ELITE_QUOTES = {
  void_caller: "The void showed me truth. Now I'll show you.",
  stone_sentinel: "*grinding stone sounds* PROTECT... DESTROY... PROTECT...",
};
```

### Balance Notes

| Elite | HP | Avg Damage/Turn | Special | Difficulty |
|-------|-----|-----------------|---------|------------|
| Void Caller | 85 | 8.5 (+ minions) | Summons, AoE | High - attrition |
| Stone Sentinel | 100 | 9.0 | Regen armor, Enrage | High - DPS check |

Strategies:
- **Void Caller**: Kill tendrils first, or burst Void Caller before phase 2
- **Stone Sentinel**: Chip through armor, prepare for enrage burst

## Testing

### Test File Location
`src/tests/enemies/Act2Elites.test.ts`

### Key Test Scenarios

1. **Void Caller Phase 1**: Summons tendrils correctly
2. **Void Caller Phase 2**: Transitions at 50% HP
3. **Void Storm**: Damages player AND all enemies
4. **Consume Tendril**: Heals and removes a tendril
5. **Stone Sentinel Armor**: Regenerates at turn start
6. **Stone Sentinel Enrage**: +5 damage, armor stops regenerating
7. **Elite Rewards**: Guaranteed uncommon+ card

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
