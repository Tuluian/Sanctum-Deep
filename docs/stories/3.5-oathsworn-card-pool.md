# Story 3.5: Oathsworn Card Pool

## Status: Complete

## Story

**As an** Oathsworn player,
**I want** a full pool of celestial cards to discover during my run,
**so that** I can build diverse decks around Vows, Judgment cards, and combo chains.

---

## Narrative Context: The Weight of Vows

> *"I swore to destroy this place. The Order said it was righteous. The Order said it was necessary. The Order... was wrong. But a vow is a vow."*

### Card Design Philosophy

Oathsworn cards should feel like:
- Sacred oaths with power—and consequence
- Righteous fury barely restrained
- The tension between duty and doubt
- Scripture becoming weaponized truth

### Callista's Voice

Cards reflect Callista's intensity and growing uncertainty. Early cards are absolute statements. Later cards show cracks. The journey from zealot to questioner is in the flavor text.

### Card Naming Convention

| Theme | Naming Pattern | Examples |
|-------|---------------|----------|
| Vows | "Oath of..." / "Vow of..." | "Oath of Valor," "Vow of Silence" |
| Judgment | Absolute moral terms | "Divine Judgment," "Righteous Fury" |
| Faith | Religious terminology | "Consecrate," "Sanctified," "Absolution" |
| Combat | Crusader imagery | "Smite," "Zealous Strike," "Holy Fervor" |

---

## Card Flavor Text Guide

### Starter Deck Flavor

| Card | Flavor Text |
|------|-------------|
| **Righteous Strike** | *"The Order taught me to strike true. They didn't teach me to question the target."* |
| **Oath of Valor** | *"I swear to fight. I swear not to falter. I swear—no matter the cost."* |
| **Sacred Guard** | *"My shield is my faith. My faith is unbreakable. So is my shield."* |
| **Smite** | *"Strike true and strike once. Hesitation is heresy."* |

### Common Card Flavor (The Certainty of Faith)

| Card | Flavor Text |
|------|-------------|
| **Divine Protection** | *"The Burning Truth protects its servants. We protect everyone else."* |
| **Zealous Strike** | *"Fervor is power. Doubt is death. There is no middle ground."* |
| **Oath of Protection** | *"I will not attack. I will only endure. Endurance is victory."* |
| **Minor Judgment** | *"Small judgments prepare us for large ones."* |
| **Holy Fervor** | *"The fire of faith burns twice as bright—and cuts twice as deep."* |
| **Consecrated Ground** | *"Here I stand. Here I make holy ground. Here evil cannot pass."* |
| **Vow Keeper** | *"A vow extended is faith renewed. A vow broken is—I don't break vows."* |
| **Radiant Smite** | *"The light burns. That's how you know it's working."* |
| **Faithful Guard** | *"Without vows, I am still faithful. Faith alone is armor."* |
| **Swift Justice** | *"Justice delayed is justice denied. Strike now. Question never."* |
| **Binding Light** | *"The light holds you. The light judges you. The light is... patient."* |
| **Penitent Strike** | *"Sometimes faith costs. This is that cost."* |
| **Sanctified Armor** | *"My armor is blessed. So am I. So are my enemies. We're all blessed. The blessing just hurts them."* |
| **Oath's End** | *"Vows can end without breaking. The Order taught me this. I think."* |

### Uncommon Card Flavor (The Cracks Forming)

| Card | Flavor Text |
|------|-------------|
| **Oath of Retribution** | *"Hit me and I hit back. It's justice. It's always justice. ...Isn't it?"* |
| **Sacred Vow** | *"More power. More commitment. More... certainty. I need certainty."* |
| **Vow of Silence** | *"No speeches. No Powers. Just block. Just endure. Just... don't think."* |
| **Divine Judgment** | *"The Order said I would know evil when I saw it. The King just looked sad."* |
| **Absolution** | *"End the vow. Take the peace. Is this forgiveness? Is this surrender?"* |
| **Martyr's Oath** | *"Pain heals me. That should concern me. It doesn't."* |
| **Righteous Fury** | *"Every vow I've kept is power. Every vow I've broken is—I haven't broken any. Yet."* |
| **Celestial Chain** | *"Link to link. Kill to kill. The chain grows. The chain binds."* |

### Rare Card Flavor (The Truth Burns)

| Card | Flavor Text |
|------|-------------|
| **Avatar of Justice** | *"All offense. No defense. Pure faith. Pure doubt. They feel the same."* |
| **Eternal Vow** | *"Forever. I swear forever. The word means something. It has to mean something."* |
| **Final Judgment** | *"This is what the Order trained me for. This is the end. This is—I hope this is right."* |

---

## Vow-Breaking Dialogue

When a Vow breaks, Callista speaks:

| Vow Broken | Dialogue |
|------------|----------|
| Oath of Valor | *"I... I couldn't. I needed to block. Was that weakness? Was that wisdom?"* |
| Oath of Protection | *"I attacked. I broke my word. Was the enemy worth my oath?"* |
| Oath of Retribution | *"I didn't attack this turn. Sometimes... sometimes you just survive."* |
| Sacred Vow | *"I couldn't play three cards. The deck failed me. Or I failed the deck."* |
| Vow of Silence | *"I played a Power. I needed it. The vow was limiting me. Was it wrong to break it?"* |

### Vow Completion Dialogue

When a Vow ends naturally (charges exhausted):

| Vow Completed | Dialogue |
|---------------|----------|
| Oath of Valor | *"The vow is fulfilled. I fought. I didn't falter. It cost me, but I kept my word."* |
| Oath of Protection | *"I endured. I protected. The vow is complete. Now I can fight again."* |
| Any Vow | *"Vow complete. Faith intact. For now."* |

---

## The Order's Scripture (Flavor Sources)

Oathsworn cards quote the Order of the Burning Truth:

| Scripture | Source Cards |
|-----------|--------------|
| *"The truth burns brighter than any flame."* | Zealous Strike, Radiant Smite |
| *"Break the seal. Free the bound."* | Final Judgment |
| *"Eternal service is eternal slavery."* | (Internal conflict—not quoted on cards but informs Callista's doubt) |
| *"Our founder saw the Sanctum's horror and wept."* | Minor Judgment, Divine Judgment |
| *"Hesitation is heresy."* | Smite, Swift Justice |
| *"Faith alone is armor."* | Faithful Guard, Sanctified Armor |

---

## Internal Conflict: Faith vs. Reality

As the game progresses, Callista's flavor text shifts:

### Act 1 Cards (Certainty)
Quotes are absolute. No doubt. Pure faith.
*"Strike true. Strike once."*

### Act 2 Cards (Questions)
Quotes begin to wonder. Ellipses appear. Rhetorical questions emerge.
*"Justice. It's always justice. ...Isn't it?"*

### Act 3 Cards (Reformation)
Quotes acknowledge complexity. Faith isn't rejected—it's matured.
*"This is what the Order trained me for. I hope this is right."*

---

## Warden Dialogue (Vow Triggers)

When Callista activates or breaks Vows, the Warden may comment:

**On First Vow:**
> "You bind yourself with words. Interesting. The Bonelord bound himself with pride. The Drowned King bound himself with love. Which is stronger, I wonder?"

**On Breaking a Vow:**
> "The vow breaks. You remain. Perhaps the Order's rules are not as absolute as you believed."

**On Completing a Vow:**
> "You kept your word. That means something here. The Hollow God cannot consume those who know who they are."

---

## Acceptance Criteria

1. Oathsworn has 30 total cards (4 starter + 26 obtainable)
2. Cards distributed by rarity: 15 Common, 8 Uncommon, 3 Rare
3. Cards support archetypes: Vow-based, Judgment, Retribution
4. Multiple Vow types with different restrictions/bonuses
5. Judgment cards provide powerful payoffs for maintaining Vows
6. Some cards interact with Vow state (active, broken, duration)

## Tasks / Subtasks

- [x] Design Common Oathsworn cards (15 cards)
  - [x] **Smite** (1 Resolve): Deal 6 damage
  - [x] **Divine Protection** (1 Resolve): Gain 6 block
  - [x] **Zealous Strike** (1 Resolve): Deal 5 damage. If Vow active, deal 3 more
  - [x] **Oath of Protection** (1 Resolve, Power): Gain 3 block/turn. Cannot play Attacks
  - [x] **Minor Judgment** (1 Resolve): Deal 8 damage. Requires Vow
  - [x] **Holy Fervor** (1 Resolve): Deal 4 damage twice
  - [x] **Consecrated Ground** (1 Resolve): Gain 5 block. Gain 2 more per turn of active Vow
  - [x] **Vow Keeper** (0 Resolve): Extend active Vow by 1 charge
  - [x] **Radiant Smite** (2 Resolve): Deal 10 damage
  - [x] **Faithful Guard** (1 Resolve): Gain 8 block. If no Vow active, gain 4 more
  - [x] **Swift Justice** (1 Resolve): Deal 4 damage. Draw 1 card
  - [x] **Binding Light** (1 Resolve): Deal 5 damage. Apply Bound 1 turn
  - [x] **Penitent Strike** (1 Resolve): Deal 7 damage. Lose 1 Vow charge
  - [x] **Sanctified Armor** (1 Resolve): Gain 5 block. Gain 5 Fortify
  - [x] **Oath's End** (1 Resolve): End active Vow without penalty. Gain 10 block

- [x] Design Uncommon Oathsworn cards (8 cards)
  - [x] **Oath of Retribution** (2 Resolve, Power): When attacked, deal 5 damage. Must attack each turn
  - [x] **Sacred Vow** (2 Resolve, Power): +1 Resolve per turn. Must play 3+ cards per turn
  - [x] **Vow of Silence** (1 Resolve, Power): Double block gained. Cannot play Powers
  - [x] **Divine Judgment** (2 Resolve): Deal 15 damage. Requires Vow. Exhaust
  - [x] **Absolution** (2 Resolve): End Vow, gain 5 HP per remaining charge
  - [x] **Martyr's Oath** (1 Resolve, Power): Heal 3 when damaged. Cannot heal otherwise
  - [x] **Righteous Fury** (2 Resolve): Deal 6 damage for each Vow activated this combat
  - [x] **Celestial Chain** (2 Resolve): Deal 8 damage. If this kills, reset Vow charges

- [x] Design Rare Oathsworn cards (3 cards)
  - [x] **Avatar of Justice** (3 Resolve, Power): All attacks deal double. All defense halved. Cannot be broken
  - [x] **Eternal Vow** (3 Resolve, Power): Vows no longer have charges (last forever)
  - [x] **Final Judgment** (4 Resolve, Exhaust): Deal 50 damage. Requires Vow. Ends Vow with penalty

- [x] Implement additional Vow types
  - [x] **Oath of Protection**: +3 block/turn, can't attack
  - [x] **Oath of Retribution**: Deal damage when hit, must attack each turn
  - [x] **Sacred Vow**: +1 Resolve/turn, must play 3+ cards
  - [x] **Vow of Silence**: Double block, can't play Powers
  - [x] **Martyr's Oath**: Heal when damaged, can't heal otherwise

- [x] Implement Vow interactions
  - [x] Vow charge extension
  - [x] Vow charge consumption for effects
  - [x] Track Vows activated this combat
  - [x] Safe Vow ending without penalty

- [x] Implement Judgment card synergies
  - [x] Require Vow to play
  - [x] Extra effects based on Vow type
  - [x] Interact with Vow duration

- [x] Write unit tests
  - [x] Test each Vow type restriction and bonus
  - [x] Test Vow charge mechanics
  - [x] Test Judgment cards require Vow
  - [x] Test Vow extension cards
  - [x] Test Vow-based scaling

## Dev Notes

### Oathsworn Archetypes

**Aggressive Vow Build**:
- Oath of Valor, Oath of Retribution
- Commit to offense, use Judgment cards for burst

**Defensive Vow Build**:
- Oath of Protection, Vow of Silence
- Turtle up, outlast enemies

**Vow Cycling Build**:
- Oath's End, Absolution, Vow Keeper
- Activate and end Vows for triggers

### Vow Definitions

```typescript
const VOWS: Record<string, Vow> = {
  oath_of_valor: {
    id: 'oath_of_valor',
    name: 'Oath of Valor',
    bonus: { type: 'damage_boost', amount: 4 },
    restriction: { type: 'no_block', description: 'Cannot gain block' },
    charges: 3,
    breakPenalty: [{ type: EffectType.LOSE_HP, amount: 5 }]
  },
  oath_of_protection: {
    id: 'oath_of_protection',
    name: 'Oath of Protection',
    bonus: { type: 'block_per_turn', amount: 3 },
    restriction: { type: 'no_attack', description: 'Cannot play Attack cards' },
    charges: 5,
    breakPenalty: [{ type: EffectType.LOSE_BLOCK, amount: 999 }]
  },
  oath_of_retribution: {
    id: 'oath_of_retribution',
    name: 'Oath of Retribution',
    bonus: { type: 'thorns', amount: 5 },
    restriction: { type: 'must_attack', description: 'Must play an Attack each turn' },
    charges: 4,
    breakPenalty: [{ type: EffectType.LOSE_HP, amount: 8 }]
  },
  sacred_vow: {
    id: 'sacred_vow',
    name: 'Sacred Vow',
    bonus: { type: 'resolve_boost', amount: 1 },
    restriction: { type: 'min_cards', minCards: 3, description: 'Must play 3+ cards per turn' },
    charges: 3,
    breakPenalty: [{ type: EffectType.DISCARD_HAND }]
  },
  vow_of_silence: {
    id: 'vow_of_silence',
    name: 'Vow of Silence',
    bonus: { type: 'double_block' },
    restriction: { type: 'no_power', description: 'Cannot play Power cards' },
    charges: 4,
    breakPenalty: [{ type: EffectType.EXHAUST_RANDOM, amount: 2 }]
  }
};
```

### Judgment Card Pattern

```typescript
// Judgment cards share common pattern
interface JudgmentCard extends CardDefinition {
  requiresVow: true;
  vowBonus?: {
    vowId: string;
    bonusEffects: CardEffect[];
  };
}

// Example: Divine Judgment deals +5 if Oath of Valor active
const DIVINE_JUDGMENT: JudgmentCard = {
  id: 'divine_judgment',
  name: 'Divine Judgment',
  type: CardType.ATTACK,
  cost: 2,
  requiresVow: true,
  effects: [{ type: EffectType.DAMAGE, amount: 15 }],
  vowBonus: {
    vowId: 'oath_of_valor',
    bonusEffects: [{ type: EffectType.DAMAGE, amount: 5 }]
  },
  exhaust: true
};
```

### Vow State Tracking

```typescript
interface CombatState {
  // ... existing
  vowsActivatedThisCombat: number;
  vowsCompletedThisCombat: number;
  vowsBrokenThisCombat: number;
}

// For cards like Righteous Fury
function executeRighteousFury(): void {
  const vows = state.vowsActivatedThisCombat;
  const damage = 6 * vows;
  dealDamageToEnemy(target, damage);
}
```

### Balance Notes

| Vow | Bonus Power | Restriction Severity | Risk Level |
|-----|-------------|---------------------|------------|
| Valor | High (+4 dmg) | High (no block) | Aggressive |
| Protection | Medium (+3 block/turn) | Medium (no attack) | Defensive |
| Retribution | Medium (5 thorns) | High (must attack) | Risky |
| Sacred | High (+1 Resolve) | Medium (3 cards) | Tempo |
| Silence | Very High (2x block) | Low (no Powers) | Safe |

## Testing

### Test File Location
`src/tests/cards/OathswornCards.test.ts`

### Key Test Scenarios

1. **Vow Activation**: Each Vow type activates correctly
2. **Vow Bonuses**: Damage boost, block, Resolve work
3. **Vow Restrictions**: Restrictions enforced properly
4. **Vow Breaking**: Penalties apply when broken
5. **Judgment Require**: Cards unplayable without Vow
6. **Charge System**: Charges decrement and expire
7. **Vow Tracking**: Combat stats track correctly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- All 322 tests passing (including 39 new Oathsworn card pool tests)
- No TypeScript errors

### Completion Notes List
1. Added 6 Vow types with unique bonuses and restrictions:
   - Oath of Valor: +4 damage, no block
   - Oath of Protection: +3 block/turn, no attacks
   - Oath of Retribution: 5 thorns, must attack each turn
   - Sacred Vow: +1 Resolve/turn, must play 3+ cards
   - Vow of Silence: double block, no Powers
   - Martyr's Oath: heal 3 on damage, no normal healing
2. Implemented 26 obtainable cards (15 Common, 8 Uncommon, 3 Rare)
3. Added new EffectTypes for Oathsworn mechanics:
   - DAMAGE_IF_VOW, BLOCK_PER_VOW_TURN, EXTEND_VOW, END_VOW_SAFE
   - CONSUME_VOW_CHARGE, DAMAGE_PER_VOW_ACTIVATED, HEAL_PER_VOW_CHARGE
   - BLOCK_IF_NO_VOW, APPLY_BOUND, RESET_VOW_CHARGES
4. Added new VowBonusType values: THORNS, DOUBLE_BLOCK, HEAL_ON_DAMAGE
5. Added new VowRestrictionType values: NO_POWER, MIN_CARDS, NO_HEAL
6. Added vowsActivatedThisCombat to PlayerState for tracking
7. Implemented vow breaking mechanics when restrictions are violated
8. Implemented Celestial Chain's kill-triggered vow charge reset

### File List
- `src/types/index.ts` - Added new EffectTypes, VowBonusTypes, VowRestrictionTypes, vowsActivatedThisCombat
- `src/data/cards/oathsworn.ts` - Added 6 Vow definitions and 26 cards (15 Common, 8 Uncommon, 3 Rare)
- `src/engine/CombatEngine.ts` - Added effect handlers for Oathsworn mechanics, vow tracking
- `src/data/oathsworn-cards.test.ts` - NEW: 39 tests for Oathsworn card pool
- `src/data/diabolist-cards.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat
- `src/data/knight.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat
- `src/data/oathsworn.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat
- `src/data/fey_touched.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat
- `src/data/diabolist.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat
- `src/engine/CombatEngine.test.ts` - Updated PlayerState mock with vowsActivatedThisCombat

---

## QA Results
_To be filled by QA agent_
