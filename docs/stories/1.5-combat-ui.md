# Story 1.5: Combat UI

## Status: Draft

## Story

**As a** player,
**I want** a clear visual interface showing all combat information,
**so that** I can make informed decisions and understand what's happening in battle.

## Acceptance Criteria

1. Player stats displayed: Current HP/Max HP, Block, Resolve/Max Resolve, Devotion
2. Enemy area shows: Name, HP bar with current/max, Block indicator, Intent display
3. Hand area displays all cards with: Name, Cost, Type, Description
4. Cards visually indicate if playable (sufficient Resolve) or not
5. Clicking/tapping a card plays it (with target selection for attacks)
6. End Turn button is prominently displayed and functional
7. Draw pile and Discard pile card counts are visible
8. Combat log shows recent actions (damage dealt, block gained, healing, etc.)
9. Victory/Defeat screen displays when combat ends

## Tasks / Subtasks

- [ ] Set up UI rendering foundation
  - [ ] Create UI component structure (DOM-based or Canvas)
  - [ ] Implement `render()` function that updates all UI from game state
  - [ ] Subscribe to combat engine state change events
  - [ ] Re-render affected components on state change

- [ ] Implement player stats display (AC: 1)
  - [ ] HP display: "CurrentHP / MaxHP" with visual HP bar
  - [ ] Block display: Shield icon with block value
  - [ ] Resolve display: "Current / Max" (e.g., "2/3")
  - [ ] Devotion display: Golden counter for Cleric mechanic
  - [ ] Update stats immediately when they change

- [ ] Implement enemy display area (AC: 2)
  - [ ] Enemy name prominently displayed
  - [ ] HP bar with percentage fill and "Current/Max" text
  - [ ] Block indicator (shield icon) when enemy has block
  - [ ] Intent display showing next action with icon + value
    - Attack: Sword icon + damage number
    - Defend: Shield icon + block number
  - [ ] Support multiple enemies in a row/grid

- [ ] Implement hand display (AC: 3, 4)
  - [ ] Card component showing: Name, Cost (in corner), Type label, Description
  - [ ] Cards arranged horizontally with overflow handling
  - [ ] Attack cards: Red border/accent
  - [ ] Skill cards: Blue border/accent
  - [ ] Playable cards: Full opacity, hover effect
  - [ ] Unplayable cards: Reduced opacity (50%), no hover effect

- [ ] Implement card interaction (AC: 5)
  - [ ] Click/tap on playable card initiates play
  - [ ] Skill cards: Play immediately on click
  - [ ] Attack cards: Enter target selection mode
    - Highlight valid targets (living enemies)
    - Click enemy to confirm target
    - Click elsewhere or press Escape to cancel
  - [ ] Visual feedback when card is played (card animates to discard)

- [ ] Implement End Turn button (AC: 6)
  - [ ] Large, prominent button below hand area
  - [ ] "END TURN" text clearly visible
  - [ ] Disabled state during enemy turn
  - [ ] Visual feedback on click (button press animation)
  - [ ] Triggers combat engine endTurn()

- [ ] Implement deck pile displays (AC: 7)
  - [ ] Draw pile: Card stack icon + count number
  - [ ] Discard pile: Card stack icon + count number
  - [ ] Position at bottom corners or near hand area
  - [ ] Update counts when cards are drawn/discarded

- [ ] Implement combat log (AC: 8)
  - [ ] Scrollable log area (max height with overflow)
  - [ ] Show recent combat events:
    - "You dealt X damage to [Enemy]"
    - "You gained X block"
    - "You healed X HP"
    - "[Enemy] dealt X damage (Y blocked)"
    - "[Enemy] gained X block"
  - [ ] New entries appear at bottom, auto-scroll
  - [ ] Limit to last 20-30 entries

- [ ] Implement game over screens (AC: 9)
  - [ ] Victory screen: "VICTORY!" message, green/gold theme
  - [ ] Defeat screen: "DEFEAT" message, red/dark theme
  - [ ] Overlay modal that covers combat area
  - [ ] "New Combat" or "Restart" button
  - [ ] Basic stats display (turns taken, damage dealt, etc.)

- [ ] Implement dead enemy visual state (AC: 2)
  - [ ] Dead enemies: Reduced opacity, grayed out
  - [ ] Dead enemies: Not targetable, cursor shows "not allowed"
  - [ ] Death animation (fade out or collapse) - optional polish

- [ ] Implement turn indicator
  - [ ] "Your Turn" / "Enemy Turn" indicator
  - [ ] Turn counter display
  - [ ] Phase indicator (optional, for debugging)

- [ ] Ensure mobile responsiveness
  - [ ] Touch-friendly tap targets (min 44px)
  - [ ] Responsive layout for different screen sizes
  - [ ] Cards scale appropriately on mobile
  - [ ] Test on mobile viewport sizes

## Dev Notes

### UI Architecture Options

**Option A: DOM-based (Recommended for MVP)**
- Use HTML elements with CSS styling
- Easier to implement responsive design
- Better accessibility
- React or vanilla JS both work

**Option B: Canvas-based**
- Better for complex animations
- More control over rendering
- Harder to make responsive/accessible
- Better for later polish phase

Recommendation: Start with DOM-based for MVP, consider Canvas for animations in Phase 5.

### Layout Structure

```
+------------------------------------------+
|           ENEMY AREA                      |
|  [Enemy 1]  [Enemy 2]  [Enemy 3]         |
|  HP bar     HP bar     HP bar            |
|  Intent     Intent     Intent            |
+------------------------------------------+
|           PLAYER STATS                    |
|  HP: 75/75  Block: 5  Resolve: 2/3       |
|  Devotion: 3                              |
+------------------------------------------+
|           HAND AREA                       |
|  [Card 1] [Card 2] [Card 3] [Card 4]     |
|  Draw: 5   Discard: 3                    |
+------------------------------------------+
|    [      END TURN      ]                |
+------------------------------------------+
|  Combat Log:                              |
|  - You dealt 5 damage to Cultist         |
|  - Cultist dealt 6 damage (5 blocked)    |
+------------------------------------------+
```

### Card Component Structure

```html
<div class="card attack playable">
  <div class="card-cost">1</div>
  <div class="card-name">Smite</div>
  <div class="card-type">Attack</div>
  <div class="card-description">Deal 5 damage.</div>
</div>
```

### CSS Classes Reference

```css
.card { /* Base card styles */ }
.card.attack { border-color: #e74c3c; }
.card.skill { border-color: #3498db; }
.card.playable { opacity: 1; cursor: pointer; }
.card.unplayable { opacity: 0.5; cursor: not-allowed; }
.card.targeting { /* During target selection */ }

.enemy { /* Base enemy styles */ }
.enemy.dead { opacity: 0.3; }
.enemy.targeted { /* Highlight when targeted */ }

.intent { /* Intent display */ }
.intent.attack { color: #e74c3c; }
.intent.defend { color: #3498db; }
```

### Intent Icons

Use Unicode or simple text:
- Attack: "âš”ï¸" or "Attacking for X"
- Defend: "ðŸ›¡ï¸" or "Defending for X"
- Unknown: "â“"

### Prototype Reference

`sanctum-deep-mobile.html` has a working UI that should be referenced:
- Player stats in grid layout
- Card display with cost, name, type, description
- Enemy HP bar with percentage fill
- Intent display with emoji icons
- Combat log with scrolling

### State-to-UI Binding

```typescript
// Subscribe to state changes
combatEngine.subscribe((event) => {
  switch (event.type) {
    case 'HP_CHANGED':
      updatePlayerHP(event.data);
      break;
    case 'CARD_PLAYED':
      removeCardFromHand(event.data.cardIndex);
      updateResolve(event.data.newResolve);
      break;
    case 'ENEMY_DAMAGED':
      updateEnemyHP(event.data.enemyIndex, event.data.newHP);
      addToLog(`Dealt ${event.data.damage} to ${event.data.enemyName}`);
      break;
    // etc.
  }
});
```

### File Structure

```
src/
  ui/
    components/
      PlayerStats.ts
      EnemyDisplay.ts
      CardComponent.ts
      Hand.ts
      CombatLog.ts
      EndTurnButton.ts
      GameOverModal.ts
    UIManager.ts       - Main UI controller
    styles.css         - All UI styles
  combat/
    CombatEngine.ts    - Already has event system from Story 1.1
```

### Integration with Previous Stories

- **Story 1.1**: Subscribe to state change events
- **Story 1.2**: Call playCard() when card is clicked
- **Story 1.3**: Display Devotion counter for Cleric
- **Story 1.4**: Display enemy intent from AI system

## Testing

### Test File Location
`src/tests/ui/CombatUI.test.ts` (if unit testing UI components)

### Manual Testing Checklist

1. [ ] Player stats update when HP/Block/Resolve/Devotion change
2. [ ] Enemy HP bar reflects current HP percentage
3. [ ] Enemy intent displays correctly (icon + value)
4. [ ] Playable cards are clickable, unplayable are dimmed
5. [ ] Attack cards require target selection before playing
6. [ ] Skill cards play immediately on click
7. [ ] End Turn button triggers enemy phase
8. [ ] Combat log shows all actions
9. [ ] Victory modal appears when all enemies dead
10. [ ] Defeat modal appears when player HP reaches 0
11. [ ] Dead enemies are grayed out and not targetable
12. [ ] UI works on mobile (touch, responsive)

### Browser Testing

- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest)
- [ ] Edge (latest)
- [ ] Mobile Chrome (Android)
- [ ] Mobile Safari (iOS)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
