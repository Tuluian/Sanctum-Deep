# Story 4.3: Act 2 Boss - The Drowned King

## Status: Complete

## Story

**As a** player completing Act 2,
**I want** a challenging boss fight against the Drowned King,
**so that** I experience a narrative climax about sacrifice and memory.

---

## Narrative Context: King Aldric of Thalassar

> *"I made a bargain. My soul for their lives. The children lived. I... didn't. Not really. But I would make that choice again. Every time. Every single time."*

**True Name:** King Aldric of Thalassar, called "The Beloved"

**Entry Date:** Approximately 400 years ago

### The Kingdom of Thalassar

Thalassar was a coastal kingdom, prosperous and peaceful. King Aldric was beloved not for military conquest but for genuine kindness. He knew the names of the servants. He visited the sick. He married not for alliance but for love—a commoner named Elara who became his queen.

They had no children of their own. But Aldric considered every child in the kingdom his responsibility.

### The Plague

When the Grey Wasting came, it killed only children. No cure existed. No prayer answered. Within three months, every child in Thalassar would be dead. Aldric watched them die one by one—the baker's daughter, the smith's son, the orphans he'd personally funded care for.

He would not accept it.

### The Bargain

Aldric entered the Sanctum alone. He found the Warden—who was then still whole, still hopeful. The Warden explained: the Hollow God could be petitioned, but the price would be absolute.

Aldric's bargain:
- His soul, his identity, his memories—all of it
- In exchange: the plague ends. Every child survives.

The Hollow God accepted. The plague vanished overnight. The children woke healthy, confused, wondering why their parents wept with joy.

King Aldric never came home.

### What He Became

The Hollow God took Aldric's soul but couldn't fully consume his love. That love became an anchor—too strong to dissolve, too broken to function. Aldric became the Drowned King: a guardian of the Flooded Depths who still believes he's protecting Thalassar.

The kingdom is gone. It fell to civil war a century after his sacrifice. No one remembers the name "Thalassar" except scholars and the Drowned King himself.

His soldiers—the Drowned Soldiers—are memories. They're not real people who died; they're Aldric's recollections of his guard, given form by his refusal to let go. When they "die," they don't actually die. They just... stop being remembered for a moment.

### The Tragedy

Defeating the Drowned King is an act of mercy, but it's also an act of cruelty. He's finally at peace—but his love kept him together for four centuries. You're not killing a monster. You're ending a love story.

The question the fight asks: Was it worth it? The children lived. The kingdom fell anyway. Aldric forgot everything except the love. Is that enough?

---

## Pre-Boss Sequence

### Approaching the Throne Room

**Environmental Storytelling:**
- Letters from Elara, water-damaged but readable: *"You don't have to do this. We can find another way."*
- Aldric's unsent response: *"There is no other way. Forgive me. Forget me."*
- A portrait of the royal couple, Elara's face scratched out—he couldn't bear to look at her.
- The nursery, toys still arranged for children who grew up and forgot him.

### The Warden Speaks

> "The Drowned King was my friend once. His name was Aldric. He was the kindest man I ever knew."
>
> "[a long pause]"
>
> "He asked me if his sacrifice would be worth it. I told him I didn't know. I still don't. But the children lived, champion. Three thousand children woke up healthy because of what he did."
>
> "End his suffering. He's earned rest. He's earned... forgetting."

### Boss Introduction

*[The throne room is flooded waist-deep. A figure sits on a coral-encrusted throne, seawater streaming from his crown. His eyes are milky, distant. He doesn't look at you—he looks past you, at something only he can see.]*

> "You've come."
>
> *[He doesn't rise. His voice echoes strangely, as if heard underwater.]*
>
> "They all come. Seeking the core. Seeking power. Seeking... what do you seek, champion?"
>
> *[He finally looks at you. There's no malice in his gaze—only exhaustion.]*
>
> "It doesn't matter. I swore to protect them. My people. My children. You threaten the kingdom. So I must..."
>
> *[He rises. Water surges around him. The Flood begins.]*
>
> "I must protect them. Even if I can't remember why."

---

## Phase Dialogue & Narrative Moments

### Phase 1: The Protector (HP > 120)
*"He still believes he's a king. He still believes there's a kingdom to protect."*

**Phase Entry:** (No transition—this is the start)

**Move Dialogue:**
- Royal Guard: *"I learned this formation from my father's captain. He... what was his name?"*
- Trident Thrust: *"The trident was a gift from Elara. She... I can't see her face anymore."*
- Call the Depths: *"The sea answers. It always answers. It's the only thing that does."*

**On Taking Damage (random):**
- *"You fight well. You remind me of someone."*
- *"Pain. I'd forgotten what pain felt like."*
- *"Why do you fight me? I'm only trying to protect—protect—who am I protecting?"*

### Phase 2: The Bargainer (HP 60-120)
*"Transition: The mask cracks. The king remembers he made a choice."*

**Phase Transition Dialogue:**
> *[The Drowned King staggers. For a moment, his eyes clear.]*
>
> "I... I remember now. The plague. The children. I made a bargain. I MADE A BARGAIN!"
>
> *[He pounds the water with his fist. Waves crash.]*
>
> "I gave EVERYTHING! My crown! My kingdom! My—my wife's face! I can't remember her face!"
>
> *[His voice breaks.]*
>
> "Do you understand? I saved them. I saved all of them. AND THEY FORGOT ME."

**Move Dialogue:**
- Crushing Pressure: *"FEEL what I feel! The weight of a kingdom's gratitude—forgotten!"*
- Desperate Plea: *"I did this for them... I did this for them... why can't I remember them?"*
- Drown: *"Let me share this. The drowning. The forgetting. It's easier when you stop struggling."*
- Raise Tide: *"The water understands. The water remembers. Only the water."*

**On Taking Damage (random):**
- *"Yes... YES. Fight me. Make me feel something besides grief."*
- *"They lived. The children lived. That's enough. That has to be enough."*
- *"Elara... did she remarry? I hope she remarried. I hope she was happy."*

### Phase 3: The Lost (HP < 60)
*"Transition: The king begins to dissolve. The love that held him together is finally giving way."*

**Phase Transition Dialogue:**
> *[The Drowned King collapses to his knees. The water around him stills.]*
>
> "I can't... I can't remember their faces anymore."
>
> *[He looks at his hands—they're translucent, flickering.]*
>
> "The children I saved. I used to know every name. Now they're just... shapes. Echoes."
>
> *[He looks up at you. For the first time, there's something like hope in his eyes.]*
>
> "You're going to destroy me, aren't you? Please. Please let me forget. I'm so tired of remembering nothing."

**Move Dialogue:**
- Tidal Wave: *"ENOUGH! If I must drown, I'll take you with me!"*
- Memory of the Kingdom: *"Come, my guard! Protect your king! Protect... someone. Protect someone. I don't remember who."*
- Final Sacrifice: *"I gave my soul for them. What's a little more?"*
- Forgotten Purpose: *[He simply stands still, staring at nothing. No dialogue—just silence and the sound of water.]*

**On Taking Damage (random):**
- *"Thank you. Every blow is a memory I no longer have to carry."*
- *"She had brown hair. Elara. I remember that. I think."*
- *"End it. Please. I want to rest. I want to forget."*

---

## The Drowned Soldiers: Memories Made Manifest

The soldiers he summons aren't real ghosts—they're his memories given form.

**Design Notes:**
- They flicker in and out of visibility
- They wear the livery of Thalassar, but the crest keeps changing—he can't remember it exactly
- They don't speak except on death

**Death Quote (Drowned Soldier):**
*"My king... we are proud... to have served..."*

**When All Soldiers Die:**
The Drowned King: *"No. No, please. Don't take them. They're all I have left of—of—I can't remember what."*

---

## Death Sequence

When the Drowned King's HP reaches 0:

> *[The Flood recedes. The water drains away, leaving the throne room dry for the first time in centuries.]*
>
> *[The Drowned King sits on his throne, no longer a monster—just a tired, broken man.]*
>
> "It's over. Finally. It's over."
>
> *[He looks at you. His eyes are clear—truly clear—for the first time.]*
>
> "Tell me. Did it work? The children. The plague. Did they survive?"
>
> **[Player is given a choice:]**
> - **Truth:** "They did. Three thousand children lived because of you."
> - **Mercy:** "They did. And Thalassar still stands, strong and proud."
> - **Silence:** [Say nothing]
>
> *[If Truth or Mercy:]*
> "Then it was worth it. All of it. Every forgotten face. Every year in the dark."
>
> *[If Silence:]*
> "I'll take your silence as kindness. Thank you."
>
> *[He reaches up to remove his crown—but it won't come off. It's fused to him.]*
>
> "The crown won't... I can't..."
>
> *[He stops. Smiles sadly.]*
>
> "It doesn't matter. I'm done with crowns."
>
> *[He looks past you, at something invisible. His expression softens.]*
>
> "Elara. There you are. I'm sorry it took so long. I'm sorry I forgot your face."
>
> *[He closes his eyes.]*
>
> "I remember it now."
>
> *[King Aldric of Thalassar dissolves into sea foam. The throne crumbles. Only his crown remains, lying in a pool of water that slowly evaporates.]*

---

## Post-Boss: The Warden Speaks

> "Aldric was my friend. The closest thing to a friend a Warden can have."
>
> "He asked me once—long ago, when we could still talk—if I thought love was worth the pain. I told him I didn't know. I'd forgotten what love felt like."
>
> *[Pause.]*
>
> "He said: 'Then let me remind you.' And he told me about Elara. About the children. About the kingdom he would never see again."
>
> "He reminded me what I was guarding. Not just a prison. A world where love like his can exist."
>
> *[Longer pause.]*
>
> "The path to Act 3 opens, champion. The Hollow God awaits. It will try to take everything from you—your memories, your name, your love."
>
> "Remember Aldric. Remember what he gave. And when the void offers you emptiness..."
>
> "Choose to remember."

---

## Class-Specific Moments

### Cleric
**Before Combat:**
> "A healer. Aldric would have appreciated that. He spent his last year as king sitting with dying children, holding their hands."

**During Combat (Phase 2):**
Aldric: *"You have healing in your hands. I can feel it. You could have saved them without the bargain. Why weren't you there? WHY WEREN'T YOU THERE?"*

**After Combat:**
> "Elara prayed, you know. Every day he was gone. Her god never answered. Perhaps that's why your god fell silent—he couldn't bear to hear prayers he couldn't answer."

### Dungeon Knight
**Before Combat:**
> "Aldric trained with the Order of the Sealed Gate in his youth. He wasn't very good. But he was determined."

**During Combat (Phase 1):**
Aldric: *"That stance. The Order's third form. I could never master it. My instructor said I was too gentle. Too soft."*

**After Combat:**
> "Aldric failed the Order's trials. They said a king shouldn't risk himself in combat. He always regretted not standing at the gate. Perhaps you can stand where he couldn't."

### Diabolist
**Before Combat:**
> "Aldric made a bargain. You understand bargains. The difference? He asked for nothing for himself."

**During Combat (Phase 2):**
Aldric: *"I can smell the brimstone on you. A contractor's mark. Tell me—did your devil promise you something worth dying for? Or just something worth living for?"*

**After Combat:**
> "Xan'thrax would never understand Aldric's bargain. A deal with no personal gain? Devils don't compute that. It frightens them."

### Oathsworn
**Before Combat:**
> "The Order of the Burning Truth would call Aldric a victim of the Warden system. They'd be wrong. He wasn't trapped here. He chose to stay."

**During Combat (Phase 3):**
Aldric: *"You carry vows like chains. I understand. My vow was to protect them. I kept it. Did keeping yours cost you everything too?"*

**After Combat:**
> "Your Order believes breaking the seal would free souls like Aldric. It wouldn't. He's free now. The seal didn't bind him. Love did."

### Fey-Touched
**Before Combat:**
> "Aldric never encountered the fey. He was lucky. Oberon would have found his devotion... amusing."

**During Combat (Phase 2):**
Aldric: *"You didn't choose to be here. I can see it. The fey dragged you. I'm sorry. I'm sorry you didn't get to choose."*

**After Combat:**
> "Oberon is watching you fight, Wren. He saw Aldric's death. He's thinking: 'What a waste of a perfectly good soul.' He doesn't understand love. He never will."

---

## Boss Relic: Crown of the Drowned

**Standard Effect:** At the start of each combat, gain 8 block.

**Flavor Text:** *"A crown worn by a king who gave everything for his people. The metal is cold. The love that made it still radiates warmth."*

**Extended Flavor (Inspect Screen):**
> "King Aldric commissioned this crown when he took the throne. He told the smith: 'Make it uncomfortable. I should never forget the weight of responsibility.'"
>
> "The smith made it too heavy. Aldric wore it anyway. Every day. Until the day he walked into the Sanctum and never returned."
>
> "His queen kept a replica by her bedside until she died. It was buried with her."

---

## Acceptance Criteria

1. The Drowned King has 180 HP (significant boss HP pool)
2. Boss has 3 distinct phases with different movesets
3. Boss has unique "Flood" mechanic that increases pressure over time
4. Boss dialogue reveals lore about his sacrifice
5. Victory transitions player to Act 3
6. Boss feels like a "tragic hero" encounter
7. **NEW: Player choice at death affects dialogue**
8. **NEW: Class-specific interactions throughout fight**

## Tasks / Subtasks

- [x] Design The Drowned King boss (AC: 1, 2, 3)
  - [x] **The Drowned King** (180 HP) - A monarch who sacrificed himself
    - **Phase 1: The Protector** (HP > 67%)
      - Royal Guard (Block 15, 35%)
      - Trident Thrust (Attack 10, 30%)
      - Call the Depths (Buff + Block 5, 35%)
    - **Phase 2: The Bargainer** (HP 33-67%)
      - Crushing Pressure (Attack 8, Apply Sundered 2, 30%)
      - Desperate Plea (Heal 15, 25%)
      - Drown (Attack 12, Apply Bound 1 turn, 25%)
      - Raise Tide (Block 8, Might +2, 20%)
    - **Phase 3: The Lost** (HP < 33%)
      - Tidal Wave (Attack 20, 30%)
      - Memory of the Kingdom (Summon 2 Drowned Soldiers, 25%)
      - Final Sacrifice (Attack 25, Self-damage 20, 25%)
      - Forgotten Purpose (Heal 10, 20%)

- [x] Design Drowned Soldier minion
  - [x] **Drowned Soldier** (25 HP) - Memories of his guard
    - Corroded Blade (Attack 6, 60%)
    - Shield Wall (All enemies gain 5 block, 40%)

- [ ] Implement Flood mechanic (AC: 3) - **Deferred to CombatEngine update**
  - [ ] Flood counter visible on screen
  - [ ] Flood threshold effects

- [ ] Implement boss dialogue system (AC: 4) - **Future story**
  - [ ] Dialogue triggers on phase transitions

- [ ] Update CombatEngine for boss mechanics - **Future story**
  - [ ] Track Flood level
  - [ ] Apply Flood effects at appropriate times

- [ ] Create boss encounter UI - **Future story**
  - [ ] Large boss health bar with phase markers
  - [ ] Flood meter visual

- [ ] Implement boss rewards - **Future story**

- [ ] Create transition to Act 3 - **Future story**

- [x] Write unit tests (43 tests)
  - [x] Test 180 HP (higher than Act 1 boss)
  - [x] Test 3 phases with HP thresholds at 67% and 33%
  - [x] Test each phase has correct moves
  - [x] Test summon soldiers in Phase 3
  - [x] Test Drowned Soldier stats (25 HP, 2 moves)

## Dev Notes

### Narrative Context

From IDEAS-Narrative-Architecture:
> "The Drowned King (Boss): A monarch who entered to save his kingdom from plague. He made a pact with the Hollow God — his soul for his kingdom's survival. The kingdom lived. He didn't. Now he guards the path to the core, still believing he's protecting his people, which exist only in his shattered memories."

The Drowned King is a tragic figure. He's not evil - he's lost. His "soldiers" are memories, not real beings. Defeating him should feel melancholy, not triumphant.

### The Flood Mechanic

The Flood represents his domain - water that responds to his will. As the fight progresses, the water rises, making the fight harder.

```typescript
interface DrownedKingState {
  floodLevel: number; // 0-10
  phase: 1 | 2 | 3;
  soldiersAlive: number;
}

const FLOOD_THRESHOLDS = {
  3: { effect: 'damage_reduction', amount: 2, target: 'player_attacks' },
  6: { effect: 'damage_per_turn', amount: 3, target: 'player' },
  10: { effect: 'trigger_tidal_wave' },
};

function onTurnEnd(king: Enemy, state: DrownedKingState): void {
  // Apply Flood 6+ damage
  if (state.floodLevel >= 6) {
    dealDamageToPlayer(3);
    addCombatLog("The rising waters harm you! (3 damage)");
  }

  // Auto-trigger at Flood 10
  if (state.floodLevel >= 10) {
    executeTidalWave(king, state);
  }
}

function executeTidalWave(king: Enemy, state: DrownedKingState): void {
  dealDamageToPlayer(20);
  state.floodLevel = 0;
  addCombatLog("TIDAL WAVE crashes down!");
}
```

### Phase Definitions

```typescript
const DROWNED_KING: BossDefinition = {
  id: 'drowned_king',
  name: 'The Drowned King',
  lore: {
    trueName: 'King Aldric of Thalassar',
    sacrifice: 'his soul for his kingdom\'s survival',
    wardenNote: 'The Drowned King was my friend once. End his suffering.',
  },
  maxHp: 180,
  passive: {
    name: 'Rising Tide',
    description: 'Flood level increases each turn. At 10, Tidal Wave triggers automatically.',
  },
  phases: [
    {
      name: 'The Protector',
      hpRange: { min: 120, max: 180 },
      dialogue: 'The kingdom... must... survive...',
      moves: [
        { id: 'royal_guard', name: 'Royal Guard', intent: IntentType.DEFEND, block: 15, weight: 35 },
        { id: 'trident_thrust', name: 'Trident Thrust', intent: IntentType.ATTACK, damage: 10, weight: 30 },
        { id: 'call_depths', name: 'Call the Depths', intent: IntentType.BUFF,
          special: { type: 'increase_flood', amount: 2 }, weight: 35 },
      ],
    },
    {
      name: 'The Bargainer',
      hpRange: { min: 60, max: 119 },
      dialogue: 'I gave everything! Do you understand?',
      moves: [
        { id: 'crushing_pressure', name: 'Crushing Pressure', intent: IntentType.ATTACK,
          damage: 8, status: { type: StatusType.SUNDERED, amount: 2 }, weight: 30 },
        { id: 'desperate_plea', name: 'Desperate Plea', intent: IntentType.HEAL,
          heal: 15, dialogue: 'I did this for them...', weight: 25 },
        { id: 'drown', name: 'Drown', intent: IntentType.ATTACK, damage: 12,
          status: { type: StatusType.BOUND, cardType: CardType.SKILL, duration: 1 }, weight: 25 },
        { id: 'raise_tide', name: 'Raise Tide', intent: IntentType.BUFF,
          special: { type: 'increase_flood', amount: 3 }, weight: 20 },
      ],
    },
    {
      name: 'The Lost',
      hpRange: { min: 0, max: 59 },
      dialogue: "I can't... remember their faces anymore...",
      moves: [
        { id: 'tidal_wave', name: 'Tidal Wave', intent: IntentType.ATTACK,
          damage: 20, special: { type: 'reset_flood' }, weight: 30 },
        { id: 'memory_kingdom', name: 'Memory of the Kingdom', intent: IntentType.SPAWN,
          spawnId: 'drowned_soldier', count: 2, weight: 25 },
        { id: 'final_sacrifice', name: 'Final Sacrifice', intent: IntentType.ATTACK,
          damage: 25, selfDamage: 20, weight: 25 },
        { id: 'forgotten_purpose', name: 'Forgotten Purpose', intent: IntentType.BUFF,
          special: { type: 'reduce_flood', amount: 5, heal: 10, skipAction: true }, weight: 20 },
      ],
    },
  ],
  deathDialogue: 'Finally... rest...',
};
```

### Boss Relic: Crown of the Drowned

```typescript
const CROWN_OF_DROWNED: Relic = {
  id: 'crown_of_drowned',
  name: 'Crown of the Drowned',
  description: 'At the start of each combat, gain 8 block.',
  flavor: 'A crown worn by a king who gave everything for his people.',
  rarity: 'boss',
  onCombatStart: (player: PlayerState) => {
    player.block += 8;
  },
};
```

### Visual Design

The battlefield should feel underwater:
- Blue/green tint
- Floating debris
- Bubbles rising
- Water level visually rises with Flood counter
- King has a spectral/waterlogged appearance
- Crown is cracked, worn

### Balance Notes

| Phase | HP Range | Avg Damage | Strategy |
|-------|----------|------------|----------|
| 1 | 180-121 | 6.5/turn | Build up, manage Flood |
| 2 | 120-60 | 9.0/turn | Deal with debuffs, burst |
| 3 | 59-0 | 13.0/turn | Race to finish, soldiers |

Total fight duration: 12-18 turns depending on deck
Flood reaches critical (10) around turn 6-8 if not managed

Strategies:
- Aggressive: Burst before Flood becomes dangerous
- Defensive: Block Tidal Wave, outlast
- Balanced: Keep Flood at 4-5, steady damage

## Testing

### Test File Location
`src/tests/enemies/DrownedKing.test.ts`

### Key Test Scenarios

1. **Phase Transitions**: Boss changes phases at HP thresholds
2. **Flood Increase**: Flood increases by correct amounts
3. **Flood 3**: Player attacks deal -2 damage
4. **Flood 6**: Player takes 3 damage at turn start
5. **Flood 10**: Tidal Wave auto-triggers
6. **Tidal Wave**: Deals 20 damage, resets Flood
7. **Summon Soldiers**: Creates correct minions
8. **Death Dialogue**: Triggers on defeat

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-03 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Fixed missing `radiance` and `maxRadiance` properties on PlayerState in 11 test files + main.ts
- Fixed missing CELESTIAL class entries in main.ts, ClassSelectScreen.ts (already existed in classes.ts)
- Fixed missing DIVINE_FORM status type in renderer.ts

### Completion Notes List
- Created The Drowned King boss (180 HP) with 3-phase behavior: The Protector, The Bargainer, The Lost
- Phase thresholds at 67% and 33% HP (aligned with phaseThresholds [0.67, 0.33])
- Created Drowned Soldier minion (25 HP) summoned in Phase 3
- Flood mechanic deferred to CombatEngine update - using placeholder moves
- 43 unit tests covering phases, HP scaling, moves, and minion summoning

### File List
- `src/data/enemies/act2-boss.ts` - NEW: The Drowned King boss + Drowned Soldier minion
- `src/data/enemies/act2-boss.test.ts` - NEW: 43 unit tests for Act 2 boss
- `src/ui/renderer.ts` - Added DIVINE_FORM status icon
- `src/main.ts` - Added CELESTIAL class info, radiance properties
- `src/ui/screens/ClassSelectScreen.ts` - Added CELESTIAL class description
- Multiple test files - Added radiance/maxRadiance to mock player states

---

## QA Results
_To be filled by QA agent_
